import{s as R,j as a,h as k,b as F,m as q,n as z,a as M}from"./index-DNY1EKIu.js";import{R as i}from"./vendor-CnGqnXYo.js";import"./icons-B_69n2by.js";function H(){const[p,E]=i.useState([]),[h,D]=i.useState(""),[x,A]=i.useState(""),[N,w]=i.useState(!1),[m,j]=i.useState(new Set),[r,l]=i.useState({}),[c,g]=i.useState({name:"",type:"rest",tags:"",config:`{
  "baseUrl": "https://example.com"
}`}),C=i.useRef(null),o=i.useCallback(async()=>{w(!0);try{E(await R())}finally{w(!1)}},[]);i.useEffect(()=>{o()},[o]);const u=i.useMemo(()=>{const e=h.trim().toLowerCase();return(p||[]).filter(s=>x&&String(s.type).toLowerCase()!==x?!1:e?`${s.name} ${s.type} ${(s.tags||[]).join(" ")}`.toLowerCase().includes(e):!0)},[p,h,x]);async function J(){try{const e=JSON.parse(c.config||"{}"),s=c.tags.split(",").map(t=>t.trim()).filter(Boolean);await k({name:c.name.trim(),type:c.type,config:e,tags:s}),g({name:"",type:c.type,tags:"",config:`{
}
`}),await o()}catch(e){alert(e.message||"Create failed")}}async function O(e){confirm("Delete template?")&&(await F(e),await o())}async function T(){m.size&&confirm(`Delete ${m.size} templates?`)&&(await q(Array.from(m)),j(new Set),await o())}function L(e){j(s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})}function K(){const e=u.map(t=>t.id),s=e.every(t=>m.has(t));j(new Set(s?[]:e))}function U(e){let s="";try{s=JSON.stringify(e.config??{},null,2)}catch{s="{}"}l(t=>({...t,[e.id]:{name:e.name,type:e.type,tags:(e.tags||[]).join(", "),config:s,configError:""}}))}function v(e){l(s=>{const t={...s};return delete t[e],t})}function f(e,s){var t;if(s.key==="Escape"){s.preventDefault(),v(e);return}s.key==="Enter"&&((((t=s.target)==null?void 0:t.tagName)||"").toUpperCase()==="TEXTAREA"?(s.ctrlKey||s.metaKey)&&(s.preventDefault(),b(e)):(s.preventDefault(),b(e)))}async function b(e){try{const s=r[e],t=String(s.tags||"").split(",").map(d=>d.trim()).filter(Boolean);let n;if(s.config!=null)try{n=JSON.parse(s.config||"{}")}catch(d){l(y=>({...y,[e]:{...y[e],configError:String(d.message||"Invalid JSON")}}));return}await z(e,{name:s.name,type:s.type,tags:t,...n!==void 0?{config:n}:{}}),v(e),await o()}catch(s){alert(s.message||"Update failed")}}async function $(e){try{const s=`${e.name} (copy)`,t=await k({name:s,type:e.type,tags:Array.isArray(e.tags)?e.tags:[],config:e.config||{}});let n="{}";try{n=JSON.stringify(t.config??{},null,2)}catch{n="{}"}l(d=>({...d,[t.id]:{name:t.name,type:t.type,tags:(t.tags||[]).join(", "),config:n,configError:""}})),await o()}catch(s){alert(s.message||"Clone failed")}}async function B(e){try{const s=await e.text(),t=JSON.parse(s),n=Array.isArray(t)?t:t.templates||[];await M(n),await o()}catch(s){alert(s.message||"Import failed")}}const I=i.useMemo(()=>Array.from(new Set((p||[]).map(e=>String(e.type||"").toLowerCase()))),[p]),S=i.useMemo(()=>{const e=new Set;return(p||[]).forEach(s=>(s.tags||[]).forEach(t=>e.add(t))),Array.from(e).sort()},[p]);return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-lg font-semibold",children:"Templates (Server)"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{className:"px-3 py-1.5 border rounded",onClick:o,disabled:N,children:N?"Syncingâ€¦":"Sync"}),a.jsx("button",{className:"px-3 py-1.5 border rounded",onClick:()=>{var e;return(e=C.current)==null?void 0:e.click()},children:"Import"}),a.jsx("a",{className:"px-3 py-1.5 border rounded",href:"/unicon/api/templates/export",children:"Export"}),a.jsx("input",{ref:C,type:"file",accept:"application/json",className:"hidden",onChange:e=>{var t;const s=(t=e.target.files)==null?void 0:t[0];s&&B(s),e.target.value=""}})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox","aria-label":"Select all",onChange:K,checked:u.length>0&&u.every(e=>m.has(e.id))}),a.jsx("button",{className:"px-3 py-1.5 border rounded",onClick:T,disabled:!m.size,children:"Delete selected"}),a.jsx("input",{className:"border rounded px-3 py-1.5 flex-1",placeholder:"Search by name/type/tag",value:h,onChange:e=>D(e.target.value)}),a.jsxs("select",{className:"border rounded px-2 py-1.5",value:x,onChange:e=>A(e.target.value),children:[a.jsx("option",{value:"",children:"All types"}),I.map(e=>a.jsx("option",{value:e,children:e.toUpperCase()},e))]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[u.map(e=>a.jsxs("div",{className:`border rounded p-3 ${m.has(e.id)?"bg-blue-50":""}`,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"mr-2",children:a.jsx("input",{type:"checkbox",checked:m.has(e.id),onChange:()=>L(e.id)})}),a.jsx("div",{className:"flex-1",children:r[e.id]?a.jsxs("div",{className:"grid grid-cols-3 gap-2 items-center",children:[a.jsx("input",{className:"border rounded px-2 py-1 text-sm",value:r[e.id].name,onKeyDown:s=>f(e.id,s),onChange:s=>l(t=>({...t,[e.id]:{...t[e.id],name:s.target.value}}))}),a.jsx("select",{className:"border rounded px-2 py-1 text-sm",value:r[e.id].type,onKeyDown:s=>f(e.id,s),onChange:s=>l(t=>({...t,[e.id]:{...t[e.id],type:s.target.value}})),children:["rest","websocket","opc-ua","sql","grpc","cpd","ssh","ftp","sftp","k8s"].map(s=>a.jsx("option",{value:s,children:s},s))}),a.jsxs("div",{children:[a.jsx("input",{className:"border rounded px-2 py-1 text-sm w-full",placeholder:"tag1, tag2",value:r[e.id].tags,onKeyDown:s=>f(e.id,s),onChange:s=>l(t=>({...t,[e.id]:{...t[e.id],tags:s.target.value}}))}),S.length>0&&a.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:S.filter(s=>!String(r[e.id].tags||"").toLowerCase().split(",").map(t=>t.trim()).includes(s.toLowerCase())).slice(0,8).map(s=>a.jsx("button",{className:"text-xs px-2 py-0.5 border rounded hover:bg-gray-50",onClick:()=>{l(t=>{const n=t[e.id],d=String(n.tags||"").split(",").map(y=>y.trim()).filter(Boolean);return d.includes(s)||d.push(s),{...t,[e.id]:{...n,tags:d.join(", ")}}})},children:s},s))})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"font-medium",children:e.name}),a.jsx("div",{className:"text-xs text-gray-500",children:String(e.type).toUpperCase()})]})}),r[e.id]?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{className:"px-2 py-1 text-sm border rounded bg-blue-600 text-white",onClick:()=>b(e.id),disabled:!!r[e.id].configError,children:"Save"}),a.jsx("button",{className:"px-2 py-1 text-sm border rounded",onClick:()=>v(e.id),children:"Cancel"})]}):a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{className:"px-2 py-1 text-sm border rounded",onClick:()=>U(e),children:"Edit"}),a.jsx("button",{className:"px-2 py-1 text-sm border rounded",onClick:()=>$(e),children:"Clone"}),a.jsx("button",{className:"px-2 py-1 text-sm border rounded",onClick:()=>O(e.id),children:"Delete"})]})]}),r[e.id]?a.jsxs("div",{className:"mt-3",children:[a.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Config (JSON)"}),a.jsx("textarea",{rows:8,className:`w-full border rounded px-2 py-1 font-mono text-xs ${r[e.id].configError?"border-red-500":""}`,value:r[e.id].config,onKeyDown:s=>f(e.id,s),onChange:s=>l(t=>({...t,[e.id]:{...t[e.id],config:s.target.value,configError:""}}))}),a.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs",children:[a.jsx("button",{className:"px-2 py-0.5 border rounded",onClick:()=>{try{const s=JSON.stringify(JSON.parse(r[e.id].config||"{}"),null,2);l(t=>({...t,[e.id]:{...t[e.id],config:s,configError:""}}))}catch(s){l(t=>({...t,[e.id]:{...t[e.id],configError:String(s.message||"Invalid JSON")}}))}},children:"Format"}),r[e.id].configError&&a.jsx("span",{className:"text-red-600",children:r[e.id].configError})]})]}):a.jsxs(a.Fragment,{children:[Array.isArray(e.tags)&&e.tags.length>0&&a.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:["Tags: ",e.tags.join(", ")]}),a.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Updated: ",new Date(e.ts||Date.now()).toLocaleString()]})]})]},e.id)),u.length===0&&a.jsx("div",{className:"text-gray-500",children:"No templates"})]}),a.jsxs("div",{className:"border rounded p-3",children:[a.jsx("div",{className:"font-medium mb-2",children:"Create new template"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"Name"}),a.jsx("input",{className:"w-full border rounded px-3 py-1.5",value:c.name,onChange:e=>g(s=>({...s,name:e.target.value}))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"Type"}),a.jsx("select",{className:"w-full border rounded px-3 py-1.5",value:c.type,onChange:e=>g(s=>({...s,type:e.target.value})),children:["rest","websocket","opc-ua","sql","grpc","cpd","ssh","ftp","sftp","k8s"].map(e=>a.jsx("option",{value:e,children:e},e))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm mb-1",children:"Tags (comma-separated)"}),a.jsx("input",{className:"w-full border rounded px-3 py-1.5",value:c.tags,onChange:e=>g(s=>({...s,tags:e.target.value}))})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm mb-1",children:"Config (JSON)"}),a.jsx("textarea",{rows:8,className:"w-full border rounded px-3 py-2 font-mono text-sm",value:c.config,onChange:e=>g(s=>({...s,config:e.target.value}))})]})]}),a.jsx("div",{className:"mt-3",children:a.jsx("button",{className:"px-3 py-1.5 border rounded bg-blue-600 text-white",onClick:J,children:"Create"})})]})]})}export{H as default};
//# sourceMappingURL=TemplatesAdmin-B2cxsE1O.js.map
