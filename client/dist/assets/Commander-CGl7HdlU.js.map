{"version":3,"file":"Commander-CGl7HdlU.js","sources":["../../src/workspaces/file-commander/Commander.jsx"],"sourcesContent":["// client/src/workspaces/file-commander/Commander.jsx\r\nimport React from 'react';\r\nimport { listConnections, connectConnection, disconnectConnection, op } from '../../lib/api';\r\nimport Button from '../../ui/Button.jsx';\r\nimport Input from '../../ui/Input.jsx';\r\nimport Select from '../../ui/Select.jsx';\r\n\r\nfunction usePane() {\r\n  const [conn, setConn] = React.useState(null);\r\n  const [cwd, setCwd] = React.useState('.');\r\n  const [items, setItems] = React.useState([]);\r\n  const [sel, setSel] = React.useState(new Set());\r\n  const [loading, setLoading] = React.useState(false);\r\n\r\n  const list = React.useCallback(async (dir) => {\r\n    if (!conn || conn.status !== 'connected') return;\r\n    const path = dir ?? cwd;\r\n    setLoading(true);\r\n    try {\r\n      const res = await op(conn.id, 'list', { path });\r\n      if (res?.success) { setItems(res.data || []); setCwd(path); setSel(new Set()); }\r\n    } finally { setLoading(false); }\r\n  }, [conn, cwd]);\r\n\r\n  const goUp = () => {\r\n    if (!cwd || cwd === '.' || cwd === '/') { list('/'); return; }\r\n    const parts = String(cwd).replace(/\\\\+/g,'/').split('/'); parts.pop();\r\n    list(parts.join('/') || '/');\r\n  };\r\n\r\n  const open = (entry) => {\r\n    const isDir = entry.isDirectory === true || entry.type === 'd' || entry.type === 1;\r\n    if (isDir) {\r\n      const next = (cwd === '/' ? `/${entry.name}` : `${cwd}/${entry.name}`);\r\n      list(next);\r\n    } else {\r\n      const next = new Set(sel); if (next.has(entry.name)) next.delete(entry.name); else next.add(entry.name); setSel(next);\r\n    }\r\n  };\r\n\r\n  return { conn, setConn, cwd, setCwd, items, sel, setSel, list, goUp, open, loading };\r\n}\r\n\r\nasync function copyOne({ src, dst, name }) {\r\n  const srcPath = (src.cwd === '/' ? `/${name}` : `${src.cwd}/${name}`);\r\n  const dstPath = (dst.cwd === '/' ? `/${name}` : `${dst.cwd}/${name}`);\r\n  const dl = await op(src.conn.id, 'download', { path: srcPath });\r\n  if (!dl?.success) throw new Error(dl?.error || 'download failed');\r\n  const up = await op(dst.conn.id, 'upload', { path: dstPath, base64: dl.data?.base64 });\r\n  if (!up?.success) throw new Error(up?.error || 'upload failed');\r\n}\r\n\r\nexport default function Commander() {\r\n  const left = usePane();\r\n  const right = usePane();\r\n  const [all, setAll] = React.useState([]);\r\n  const [busy, setBusy] = React.useState(false);\r\n  const [progress, setProgress] = React.useState({ totalFiles: 0, doneFiles: 0, totalBytes: 0, doneBytes: 0, running: false, phase: '' });\r\n\r\n  const reloadConns = async () => {\r\n    const d = await listConnections();\r\n    const list = (d.connections || []).filter(c => ['localfs','ftp','sftp'].includes(c.type));\r\n    setAll(list);\r\n  };\r\n  React.useEffect(() => { reloadConns(); }, []);\r\n\r\n  const ensureConnected = async (pane) => {\r\n    if (!pane.conn) return;\r\n    if (pane.conn.status !== 'connected') {\r\n      await connectConnection(pane.conn.id);\r\n      pane.setConn({ ...pane.conn, status: 'connected' });\r\n    }\r\n    await pane.list('.');\r\n  };\r\n\r\n  function norm(pathStr) { return String(pathStr || '').replace(/\\\\+/g,'/').replace(/\\/+/, '/'); }\r\n  function join(a,b){ if(!a||a==='.') return b||''; if(a.endsWith('/')) return b?`${a}${b}`:a; return b?`${a}/${b}`:a; }\r\n  function parentDir(p){ const n = norm(p); const parts = n.split('/'); parts.pop(); return parts.join('/') || '/'; }\r\n  async function ensureDir(pane, dirPath){ // create nested dirs, ignore errors\r\n    const n = norm(dirPath);\r\n    if (!n || n === '.' || n === '/') return;\r\n    const parts = n.split('/');\r\n    let acc = '';\r\n    for (const part of parts) {\r\n      acc = acc ? `${acc}/${part}` : part;\r\n      try { await op(pane.conn.id, 'mkdir', { path: acc }); } catch(_) { /* ignore */ }\r\n    }\r\n  }\r\n\r\n  async function buildPlan(src, dst, names){\r\n    const files = [];\r\n    let totalBytes = 0;\r\n    const base = norm(src.cwd);\r\n    const byName = new Map((src.items||[]).map(it=>[it.name,it]));\r\n    async function walk(absPath, relRoot){\r\n      const res = await op(src.conn.id, 'list', { path: absPath });\r\n      const entries = res?.data || [];\r\n      for (const e of entries){\r\n        const absChild = join(absPath, e.name);\r\n        const relChild = join(relRoot, e.name);\r\n        const isDir = e.isDirectory===true || e.type==='d' || e.type===1;\r\n        if (isDir){ await walk(absChild, relChild); }\r\n        else { const size = Number(e.size||0); totalBytes += size; files.push({ srcPath: absChild, rel: relChild, size }); }\r\n      }\r\n    }\r\n    for (const name of names){\r\n      const entry = byName.get(name);\r\n      const abs = join(base, name);\r\n      const isDir = entry && (entry.isDirectory===true || entry.type==='d' || entry.type===1);\r\n      if (isDir) { await walk(abs, name); }\r\n      else { const size = Number(entry?.size||0); totalBytes += size; files.push({ srcPath: abs, rel: name, size }); }\r\n    }\r\n    return { files, totalBytes };\r\n  }\r\n\r\n  const copy = async (src, dst) => {\r\n    if (!src.conn || !dst.conn) return;\r\n    const names = Array.from(src.sel);\r\n    if (!names.length) return;\r\n    setBusy(true);\r\n    try {\r\n      // Build copy plan (recurses into folders)\r\n      setProgress({ totalFiles: 0, doneFiles: 0, totalBytes: 0, doneBytes: 0, running: true, phase: 'Scanning…' });\r\n      const { files, totalBytes } = await buildPlan(src, dst, names);\r\n      setProgress({ totalFiles: files.length, doneFiles: 0, totalBytes, doneBytes: 0, running: true, phase: 'Copying…' });\r\n\r\n      for (let i=0;i<files.length;i++){\r\n        const f = files[i];\r\n        const dstPath = join(dst.cwd, f.rel);\r\n        await ensureDir(dst, parentDir(f.rel));\r\n        const dl = await op(src.conn.id, 'download', { path: f.srcPath });\r\n        if (!dl?.success) throw new Error(dl?.error || 'download failed');\r\n        await op(dst.conn.id, 'upload', { path: dstPath, base64: dl.data?.base64 });\r\n        setProgress(prev => ({ ...prev, doneFiles: i+1, doneBytes: Math.min(prev.totalBytes, prev.doneBytes + (f.size||0)) }));\r\n      }\r\n\r\n      await dst.list(dst.cwd);\r\n      setProgress(prev => ({ ...prev, running: false, phase: 'Done' }));\r\n    } catch (e) { setProgress(prev=>({ ...prev, running:false, phase: 'Error' })); alert(e.message || 'copy failed'); }\r\n    finally { setBusy(false); }\r\n  };\r\n\r\n  const ConnPicker = ({ pane }) => (\r\n    <div className=\"flex items-center gap-2\">\r\n      <Select value={pane.conn?.id || ''} onChange={(e)=>{\r\n        const id = e.target.value; const c = all.find(x=>x.id===id) || null; pane.setConn(c); if (c?.status==='connected') pane.list('.');\r\n      }}>\r\n        <option value=\"\">Pick connection…</option>\r\n        {all.map(c => (<option key={c.id} value={c.id}>{c.type.toUpperCase()} • {c.name}</option>))}\r\n      </Select>\r\n      <Button variant=\"secondary\" onClick={()=>ensureConnected(pane)} disabled={!pane.conn || pane.conn.status==='connected'}>Connect</Button>\r\n      <Button variant=\"secondary\" onClick={async()=>{ if(!pane.conn) return; await disconnectConnection(pane.conn.id); pane.setConn({ ...pane.conn, status:'disconnected' }); }} disabled={!pane.conn || pane.conn.status!=='connected'}>Disconnect</Button>\r\n    </div>\r\n  );\r\n\r\n  const Pane = ({ pane, side, onDropFromOther }) => (\r\n    <div className=\"flex-1 flex flex-col border rounded\">\r\n      <div className=\"flex items-center gap-2 p-2 border-b\">\r\n        <Button variant=\"secondary\" onClick={pane.goUp}>Up</Button>\r\n        <Button variant=\"secondary\" onClick={()=>pane.list(pane.cwd)}>Refresh</Button>\r\n        <Input className=\"flex-1\" value={pane.cwd} onChange={e=>pane.setCwd(e.target.value)} />\r\n        <Button onClick={()=>pane.list(pane.cwd)} disabled={!pane.conn || pane.conn.status!=='connected'}>Go</Button>\r\n      </div>\r\n      <div className=\"flex-1 overflow-auto\" onDragOver={(e)=>e.preventDefault()} onDrop={(e)=>{\r\n        try {\r\n          const s = e.dataTransfer.getData('application/x-unicon');\r\n          if (!s) return;\r\n          const payload = JSON.parse(s);\r\n          if (payload.from && payload.from !== side && Array.isArray(payload.names) && payload.names.length){ onDropFromOther(payload.names, payload.from); }\r\n        } catch(_){}\r\n      }}>\r\n        <table className=\"w-full text-sm\">\r\n          <thead className=\"bg-gray-50\"><tr><th className=\"px-2 py-1 w-6\"></th><th className=\"text-left px-2 py-1\">Name</th><th className=\"text-left px-2 py-1\">Type</th><th className=\"text-left px-2 py-1\">Size</th></tr></thead>\r\n          <tbody>\r\n            {pane.items.map((it,i)=>{\r\n              const isDir = it.isDirectory===true || it.type==='d' || it.type===1; const checked = pane.sel.has(it.name);\r\n              return (\r\n                <tr key={i} className={`border-b ${checked?'bg-blue-50':''}`} draggable onDragStart={(e)=>{\r\n                  const names = pane.sel.has(it.name) ? Array.from(pane.sel) : [it.name];\r\n                  e.dataTransfer.setData('application/x-unicon', JSON.stringify({ from: side, names }));\r\n                }}>\r\n                  <td className=\"px-2 py-1\">{!isDir && (<input type=\"checkbox\" checked={checked} onChange={()=>{ const s=new Set(pane.sel); if(s.has(it.name)) s.delete(it.name); else s.add(it.name); pane.setSel(s); }} />)}</td>\r\n                  <td className=\"px-2 py-1\"><button className=\"hover:underline\" onClick={()=>pane.open(it)}>{it.name}</button></td>\r\n                  <td className=\"px-2 py-1\">{isDir? 'dir':'file'}</td>\r\n                  <td className=\"px-2 py-1\">{it.size ?? ''}</td>\r\n                </tr>\r\n              );\r\n            })}\r\n            {!pane.items.length && (<tr><td className=\"px-3 py-6 text-center text-gray-500\" colSpan={4}>{pane.loading ? 'Loading…' : 'Empty'}</td></tr>)}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col gap-3\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-2\"><b>File Commander</b></div>\r\n        <Button variant=\"secondary\" onClick={reloadConns}>Reload connections</Button>\r\n      </div>\r\n\r\n      <div className=\"flex items-center gap-6\">\r\n        <ConnPicker pane={left} />\r\n        <div className=\"flex items-center gap-3\">\r\n          <Button onClick={()=>copy(right, left)} disabled={busy || !right.sel.size}>← Copy</Button>\r\n          <Button onClick={()=>copy(left, right)} disabled={busy || !left.sel.size}>Copy →</Button>\r\n          {progress.running && (\r\n            <div className=\"min-w-[240px] text-xs text-gray-700\">\r\n              <div className=\"w-full h-2 bg-gray-200 rounded overflow-hidden mb-1\">\r\n                <div className=\"h-2 bg-blue-600\" style={{ width: `${progress.totalBytes>0 ? Math.floor(100*(progress.doneBytes/progress.totalBytes)) : Math.floor(100*(progress.doneFiles/Math.max(1,progress.totalFiles)))}%` }} />\r\n              </div>\r\n              <div>{progress.phase} {progress.doneFiles}/{progress.totalFiles} files · {Math.round(progress.doneBytes/1024)} / {Math.round(progress.totalBytes/1024)} KB</div>\r\n            </div>\r\n          )}\r\n        </div>\r\n        <ConnPicker pane={right} />\r\n      </div>\r\n\r\n      <div className=\"flex gap-3 min-h-[400px]\">\r\n        <Pane side=\"left\" pane={left} onDropFromOther={(names)=>copy(right,left)} />\r\n        <Pane side=\"right\" pane={right} onDropFromOther={(names)=>copy(left,right)} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["usePane","conn","setConn","React","cwd","setCwd","items","setItems","sel","setSel","loading","setLoading","list","dir","path","res","op","parts","entry","next","Commander","left","right","all","setAll","busy","setBusy","progress","setProgress","reloadConns","listConnections","c","ensureConnected","pane","connectConnection","norm","pathStr","join","a","b","parentDir","p","ensureDir","dirPath","n","acc","part","buildPlan","src","dst","names","files","totalBytes","base","byName","it","walk","absPath","relRoot","entries","e","absChild","relChild","size","name","abs","copy","i","f","dstPath","dl","_a","prev","ConnPicker","jsxs","Select","id","x","jsx","Button","disconnectConnection","Pane","side","onDropFromOther","Input","s","payload","isDir","checked"],"mappings":"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"}