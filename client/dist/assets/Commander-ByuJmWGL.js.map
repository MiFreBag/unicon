{"version":3,"file":"Commander-ByuJmWGL.js","sources":["../../src/workspaces/file-commander/Commander.jsx"],"sourcesContent":["// client/src/workspaces/file-commander/Commander.jsx\r\nimport React from 'react';\r\nimport { listConnections, connectConnection, disconnectConnection, op } from '../../lib/api';\r\nimport Button from '../../ui/Button.jsx';\r\nimport Input from '../../ui/Input.jsx';\r\nimport Select from '../../ui/Select.jsx';\r\n\r\nfunction usePane() {\r\n  const [conn, setConn] = React.useState(null);\r\n  const [cwd, setCwd] = React.useState('.');\r\n  const [items, setItems] = React.useState([]);\r\n  const [sel, setSel] = React.useState(new Set());\r\n  const [lastIndex, setLastIndex] = React.useState(-1);\r\n  const [loading, setLoading] = React.useState(false);\r\n\r\n  const list = React.useCallback(async (dir) => {\r\n    if (!conn || conn.status !== 'connected') return;\r\n    const path = dir ?? cwd;\r\n    setLoading(true);\r\n    try {\r\n      const res = await op(conn.id, 'list', { path });\r\n      if (res?.success) { setItems(res.data || []); setCwd(path); setSel(new Set()); setLastIndex(-1); }\r\n    } finally { setLoading(false); }\r\n  }, [conn, cwd]);\r\n\r\n  const goUp = () => {\r\n    if (!cwd || cwd === '.' || cwd === '/') { list('/'); return; }\r\n    const parts = String(cwd).replace(/\\\\+/g,'/').split('/'); parts.pop();\r\n    list(parts.join('/') || '/');\r\n  };\r\n\r\n  const open = (entry) => {\r\n    const isDir = entry.isDirectory === true || entry.type === 'd' || entry.type === 1;\r\n    if (isDir) {\r\n      const next = (cwd === '/' ? `/${entry.name}` : `${cwd}/${entry.name}`);\r\n      list(next);\r\n    } else {\r\n      // default single select\r\n      const next = new Set([entry.name]);\r\n      setSel(next);\r\n    }\r\n  };\r\n\r\n  function onRowClick(e, entry, index){\r\n    const isDir = entry.isDirectory === true || entry.type === 'd' || entry.type === 1;\r\n    if (isDir) return; // rows for files only affect selection; folder open via name click\r\n    const ctrl = e.ctrlKey || e.metaKey; const shift = e.shiftKey;\r\n    if (shift && lastIndex !== -1) {\r\n      const a = Math.min(lastIndex, index); const b = Math.max(lastIndex, index);\r\n      const names = items.slice(a, b+1).filter(x=>!(x.isDirectory===true || x.type==='d' || x.type===1)).map(x=>x.name);\r\n      setSel(new Set(names));\r\n    } else if (ctrl) {\r\n      const next = new Set(sel); if (next.has(entry.name)) next.delete(entry.name); else next.add(entry.name); setSel(next); setLastIndex(index);\r\n    } else {\r\n      setSel(new Set([entry.name])); setLastIndex(index);\r\n    }\r\n  }\r\n\r\n  return { conn, setConn, cwd, setCwd, items, sel, setSel, lastIndex, setLastIndex, list, goUp, open, loading, onRowClick };\r\n}\r\n\r\nasync function copyOne({ src, dst, name }) {\r\n  const srcPath = (src.cwd === '/' ? `/${name}` : `${src.cwd}/${name}`);\r\n  const dstPath = (dst.cwd === '/' ? `/${name}` : `${dst.cwd}/${name}`);\r\n  const dl = await op(src.conn.id, 'download', { path: srcPath });\r\n  if (!dl?.success) throw new Error(dl?.error || 'download failed');\r\n  const up = await op(dst.conn.id, 'upload', { path: dstPath, base64: dl.data?.base64 });\r\n  if (!up?.success) throw new Error(up?.error || 'upload failed');\r\n}\r\n\r\nexport default function Commander() {\r\n  const left = usePane();\r\n  const right = usePane();\r\n\r\n  // Native (browser) local left pane\r\n  const localLeft = useLocalPane();\r\n  const [useLocalLeft, setUseLocalLeft] = React.useState(false);\r\n  const [all, setAll] = React.useState([]);\r\n  const [busy, setBusy] = React.useState(false);\r\n  const [progress, setProgress] = React.useState({ totalFiles: 0, doneFiles: 0, totalBytes: 0, doneBytes: 0, running: false, phase: '' });\r\n  const [queue, setQueue] = React.useState([]); // tasks: {jobId,srcConnId,dstConnId,srcPath,dstPath,size}\r\n  const [paused, setPaused] = React.useState(false);\r\n  const processingRef = React.useRef(false);\r\n  const [inflight, setInflight] = React.useState({ jobId: null, bytes: 0, total: 0 });\r\n\r\n  const reloadConns = async () => {\r\n    const d = await listConnections();\r\n    const list = (d.connections || []).filter(c => ['localfs','ftp','sftp'].includes(c.type));\r\n    setAll(list);\r\n  };\r\n  React.useEffect(() => { reloadConns(); }, []);\r\n\r\n  // WS progress listener\r\n  React.useEffect(() => {\r\n    const onWs = (e) => {\r\n      const m = e.detail || {};\r\n      if (m.type !== 'transfer') return;\r\n      const d = m.data || {};\r\n      setInflight(prev => (prev.jobId && d.jobId === prev.jobId) ? { jobId: prev.jobId, bytes: d.bytes || 0, total: d.total || prev.total } : prev);\r\n    };\r\n    window.addEventListener('unicon-ws', onWs);\r\n    return () => window.removeEventListener('unicon-ws', onWs);\r\n  }, []);\r\n\r\n  const ensureConnected = async (pane) => {\r\n    if (!pane.conn) return;\r\n    if (pane.conn.status !== 'connected') {\r\n      await connectConnection(pane.conn.id);\r\n      pane.setConn({ ...pane.conn, status: 'connected' });\r\n    }\r\n    await pane.list('.');\r\n  };\r\n\r\n  function norm(pathStr) { return String(pathStr || '').replace(/\\\\+/g,'/').replace(/\\/+/, '/'); }\r\n  function join(a,b){ if(!a||a==='.') return b||''; if(a.endsWith('/')) return b?`${a}${b}`:a; return b?`${a}/${b}`:a; }\r\n  function parentDir(p){ const n = norm(p); const parts = n.split('/'); parts.pop(); return parts.join('/') || '/'; }\r\n  async function ensureDir(pane, dirPath){ // create nested dirs, ignore errors\r\n    const n = norm(dirPath);\r\n    if (!n || n === '.' || n === '/') return;\r\n    const parts = n.split('/');\r\n    let acc = '';\r\n    for (const part of parts) {\r\n      acc = acc ? `${acc}/${part}` : part;\r\n      try { await op(pane.conn.id, 'mkdir', { path: acc }); } catch(_) { /* ignore */ }\r\n    }\r\n  }\r\n\r\n  async function buildPlan(src, dst, names){\r\n    const files = [];\r\n    let totalBytes = 0;\r\n    const base = norm(src.cwd);\r\n    const byName = new Map((src.items||[]).map(it=>[it.name,it]));\r\n    async function walk(absPath, relRoot){\r\n      const res = await op(src.conn.id, 'list', { path: absPath });\r\n      const entries = res?.data || [];\r\n      for (const e of entries){\r\n        const absChild = join(absPath, e.name);\r\n        const relChild = join(relRoot, e.name);\r\n        const isDir = e.isDirectory===true || e.type==='d' || e.type===1;\r\n        if (isDir){ await walk(absChild, relChild); }\r\n        else { const size = Number(e.size||0); totalBytes += size; files.push({ srcPath: absChild, rel: relChild, size }); }\r\n      }\r\n    }\r\n    for (const name of names){\r\n      const entry = byName.get(name);\r\n      const abs = join(base, name);\r\n      const isDir = entry && (entry.isDirectory===true || entry.type==='d' || entry.type===1);\r\n      if (isDir) { await walk(abs, name); }\r\n      else { const size = Number(entry?.size||0); totalBytes += size; files.push({ srcPath: abs, rel: name, size }); }\r\n    }\r\n    return { files, totalBytes };\r\n  }\r\n\r\n  async function enqueueCopy(src, dst, names){\r\n    // Build plan and push to queue\r\n    setProgress(p=>({ ...p, running: true, phase: p.running ? p.phase : 'Queued', totalFiles: p.totalFiles, totalBytes: p.totalBytes }));\r\n    const { files, totalBytes } = await buildPlan(src, dst, names);\r\n    const tasks = files.map(f => ({ jobId: `${Date.now()}-${Math.random().toString(36).slice(2)}`, srcConnId: src.conn.id, dstConnId: dst.conn.id, srcPath: f.srcPath, dstPath: join(dst.cwd, f.rel), size: f.size }));\r\n    setQueue(prev => [...prev, ...tasks]);\r\n    setProgress(prev => ({ ...prev, totalFiles: prev.totalFiles + tasks.length, totalBytes: prev.totalBytes + totalBytes }));\r\n    if (!processingRef.current && !paused) processQueue();\r\n  }\r\n\r\n  async function processQueue(){\r\n    processingRef.current = true;\r\n    setProgress(prev => ({ ...prev, running: true, phase: 'Copying…' }));\r\n    while (!paused) {\r\n      let task = null;\r\n      setQueue(prev => {\r\n        if (!prev.length) return prev; task = prev[0]; return prev.slice(1);\r\n      });\r\n      if (!task) break;\r\n      try {\r\n        // Ensure parent dir exists on dst (best-effort)\r\n        await ensureDir({ conn: { id: task.dstConnId } }, parentDir(task.dstPath.replace(/^\\/+/, '')));\r\n        setInflight({ jobId: task.jobId, bytes: 0, total: task.size || 0 });\r\n        await fetch('/unicon/api/transfer/copy', { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify({ jobId: task.jobId, src: { connectionId: task.srcConnId, path: task.srcPath }, dst: { connectionId: task.dstConnId, path: task.dstPath }, size: task.size||null }) }).then(r=>r.json()).then(d=>{ if (!d?.success) throw new Error(d?.error||'copy error'); });\r\n        setProgress(prev => ({ ...prev, doneFiles: prev.doneFiles + 1, doneBytes: Math.min(prev.totalBytes, prev.doneBytes + (task.size||0)) }));\r\n      } catch (e) {\r\n        alert(`Copy failed: ${e.message || e}`);\r\n      } finally {\r\n        setInflight({ jobId: null, bytes: 0, total: 0 });\r\n      }\r\n    }\r\n    processingRef.current = false;\r\n    setProgress(prev => ({ ...prev, phase: paused ? 'Paused' : (queue.length ? 'Queued' : 'Done'), running: queue.length>0 || paused }));\r\n  }\r\n\r\n  const copy = async (src, dst) => {\r\n    if (!src.conn || !dst.conn) return;\r\n    const names = Array.from(src.sel);\r\n    if (!names.length) return;\r\n    setBusy(true);\r\n    try {\r\n      await enqueueCopy(src, dst, names);\r\n    } catch (e) { alert(e.message || 'enqueue failed'); }\r\n    finally { setBusy(false); }\r\n  };\r\n\r\n  const ConnPicker = ({ pane }) => (\r\n    <div className=\"flex items-center gap-2\">\r\n      <Select value={pane.conn?.id || ''} onChange={(e)=>{\r\n        const id = e.target.value; const c = all.find(x=>x.id===id) || null; pane.setConn(c); if (c?.status==='connected') pane.list('.');\r\n      }}>\r\n        <option value=\"\">Pick connection…</option>\r\n        {all.map(c => (<option key={c.id} value={c.id}>{c.type.toUpperCase()} • {c.name}</option>))}\r\n      </Select>\r\n      <Button variant=\"secondary\" onClick={()=>ensureConnected(pane)} disabled={!pane.conn || pane.conn.status==='connected'}>Connect</Button>\r\n      <Button variant=\"secondary\" onClick={async()=>{ if(!pane.conn) return; await disconnectConnection(pane.conn.id); pane.setConn({ ...pane.conn, status:'disconnected' }); }} disabled={!pane.conn || pane.conn.status!=='connected'}>Disconnect</Button>\r\n    </div>\r\n  );\r\n\r\n  const Pane = ({ pane, side, onDropFromOther, onDropLocal }) => (\r\n    <div className=\"flex-1 flex flex-col border rounded\">\r\n      <div className=\"flex items-center gap-2 p-2 border-b\">\r\n        <Button variant=\"secondary\" onClick={pane.goUp}>Up</Button>\r\n        <Button variant=\"secondary\" onClick={()=>pane.list(pane.cwd)}>Refresh</Button>\r\n        <Input className=\"flex-1\" value={pane.cwd} onChange={e=>pane.setCwd(e.target.value)} />\r\n        <input type=\"file\" multiple onChange={async (e)=>{\r\n          if (!pane.conn || pane.conn.status!=='connected') return;\r\n          const files = Array.from(e.target.files||[]);\r\n          for (const f of files) { const fd = new FormData(); fd.append('connectionId', pane.conn.id); fd.append('cwd', pane.cwd||'.'); fd.append('file', f, f.name); await fetch('/unicon/api/stream/upload', { method:'POST', body: fd }); }\r\n          try { await pane.list(pane.cwd); } catch(_){ }\r\n          e.target.value='';\r\n        }} />\r\n        <Button onClick={()=>pane.list(pane.cwd)} disabled={!pane.conn || pane.conn.status!=='connected'}>Go</Button>\r\n        <Button variant=\"secondary\" onClick={()=>{\r\n          if (!pane.conn || pane.conn.status!=='connected') return; const names = Array.from(pane.sel); if (!names.length) return;\r\n          for (const n of names) { const p = (pane.cwd==='/'?`/${n}`:`${pane.cwd}/${n}`); const url = `/unicon/api/stream/download?connectionId=${encodeURIComponent(pane.conn.id)}&path=${encodeURIComponent(p)}`; const a=document.createElement('a'); a.href=url; a.download=''; a.target='_blank'; document.body.appendChild(a); a.click(); a.remove(); }\r\n        }} disabled={!pane.sel.size}>Download</Button>\r\n      </div>\r\n      <div className=\"flex-1 overflow-auto\" onDragOver={(e)=>e.preventDefault()} onDrop={(e)=>{\r\n        try {\r\n          const sLocal = e.dataTransfer.getData('application/x-unicon-local');\r\n          if (sLocal) {\r\n            const payload = JSON.parse(sLocal);\r\n            if (Array.isArray(payload.relPaths) && payload.relPaths.length) { onDropLocal && onDropLocal(payload.relPaths); return; }\r\n          }\r\n          const s = e.dataTransfer.getData('application/x-unicon');\r\n          if (s) {\r\n            const payload = JSON.parse(s);\r\n            if (payload.from && payload.from !== side && Array.isArray(payload.names) && payload.names.length){ onDropFromOther(payload.names, payload.from); return; }\r\n          }\r\n        } catch(_){}}\r\n      }>\r\n        <table className=\"w-full text-sm\">\r\n          <thead className=\"bg-gray-50\"><tr><th className=\"px-2 py-1 w-6\"></th><th className=\"text-left px-2 py-1\">Name</th><th className=\"text-left px-2 py-1\">Type</th><th className=\"text-left px-2 py-1\">Size</th></tr></thead>\r\n          <tbody>\r\n            {pane.items.map((it,i)=>{\r\n              const isDir = it.isDirectory===true || it.type==='d' || it.type===1; const checked = pane.sel.has(it.name);\r\n              return (\r\n                <tr key={i} className={`border-b ${checked?'bg-blue-50':''}`} draggable onDragStart={(e)=>{\r\n                  const names = pane.sel.has(it.name) ? Array.from(pane.sel) : [it.name];\r\n                  e.dataTransfer.setData('application/x-unicon', JSON.stringify({ from: side, names }));\r\n                }} onClick={(e)=>pane.onRowClick(e, it, i)}>\r\n                  <td className=\"px-2 py-1\">{!isDir && (<input type=\"checkbox\" checked={checked} onChange={(e)=>{ e.stopPropagation(); const s=new Set(pane.sel); if(s.has(it.name)) s.delete(it.name); else s.add(it.name); pane.setSel(s); }} />)}</td>\r\n                  <td className=\"px-2 py-1\"><button className=\"hover:underline\" onClick={(e)=>{ e.stopPropagation(); pane.open(it); }}>{it.name}</button></td>\r\n                  <td className=\"px-2 py-1\">{isDir? 'dir':'file'}</td>\r\n                  <td className=\"px-2 py-1\">{it.size ?? ''}</td>\r\n                </tr>\r\n              );\r\n            })}\r\n            {!pane.items.length && (<tr><td className=\"px-3 py-6 text-center text-gray-500\" colSpan={4}>{pane.loading ? 'Loading…' : 'Empty'}</td></tr>)}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col gap-3\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-2\"><b>File Commander</b></div>\r\n        <Button variant=\"secondary\" onClick={reloadConns}>Reload connections</Button>\r\n      </div>\r\n\r\n      <div className=\"flex items-center gap-6\">\r\n        {useLocalLeft ? (\r\n          <div className=\"flex items-center gap-2\">\r\n            <Button variant=\"secondary\" onClick={async()=>{ const ok = await localLeft.pickRoot(); if (ok) await localLeft.list('.'); }}>Pick folder…</Button>\r\n            <div className=\"text-sm text-gray-600\">{localLeft.rootName || 'No folder selected'}</div>\r\n            <Button variant=\"secondary\" onClick={()=>localLeft.goUp()} disabled={!localLeft.canGoUp}>Up</Button>\r\n          </div>\r\n        ) : (\r\n          <ConnPicker pane={left} />\r\n        )}\r\n        <div className=\"flex items-center gap-3\">\r\n          <Button onClick={()=>copy(right, left)} disabled={busy || !right.sel.size}>← Copy</Button>\r\n          <Button onClick={()=>copy(left, right)} disabled={busy || !left.sel.size}>Copy →</Button>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Button variant=\"secondary\" onClick={()=>{ setPaused(true); setProgress(p=>({ ...p, phase:'Paused', running:true })); }} disabled={paused || (!progress.running && !queue.length)}>Pause</Button>\r\n            <Button variant=\"secondary\" onClick={()=>{ setPaused(false); if (!processingRef.current) processQueue(); }} disabled={!paused}>Resume</Button>\r\n            <Button variant=\"secondary\" onClick={()=>{ setQueue([]); setProgress(p=>({ ...p, running:false, phase:'Canceled' })); }} disabled={!queue.length && !progress.running}>Cancel</Button>\r\n          </div>\r\n          <div className=\"min-w-[300px] text-xs text-gray-700\">\r\n            <div className=\"w-full h-2 bg-gray-200 rounded overflow-hidden mb-1\">\r\n              <div className=\"h-2 bg-blue-600\" style={{ width: `${progress.totalBytes>0 ? Math.floor(100*((progress.doneBytes + (inflight.bytes||0))/Math.max(1,progress.totalBytes))) : Math.floor(100*(progress.doneFiles/Math.max(1,progress.totalFiles)))}%` }} />\r\n            </div>\r\n            <div>{progress.phase || (queue.length ? 'Queued' : '')} {progress.doneFiles}/{progress.totalFiles} files · {Math.round((progress.doneBytes + (inflight.bytes||0))/1024)} / {Math.round(Math.max(1,progress.totalBytes)/1024)} KB · Queue: {queue.length}</div>\r\n          </div>\r\n        </div>\r\n        <ConnPicker pane={right} />\r\n        <Button variant=\"secondary\" onClick={()=>setUseLocalLeft(v=>!v)}>{useLocalLeft ? 'Use connection on left' : 'Use Local (This computer) on left'}</Button>\r\n      </div>\r\n\r\n      <div className=\"flex gap-3 min-h-[400px]\">\r\n        {useLocalLeft ? (\r\n          <LocalPane pane={localLeft} side=\"left\" />\r\n        ) : (\r\n          <Pane side=\"left\" pane={left} onDropFromOther={(names)=>enqueueCopy(right,left,names)} />\r\n        )}\r\n        <Pane side=\"right\" pane={right} onDropFromOther={(names)=>enqueueCopy(left,right,names)} onDropLocal={async (relPaths)=>{ if (!right.conn||right.conn.status!=='connected') return; await localLeft.uploadTo(right, relPaths); await right.list(right.cwd); }} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ---- Native Local Pane using File System Access API ----\r\nfunction useLocalPane(){\r\n  const [root, setRoot] = React.useState(null); // FileSystemDirectoryHandle\r\n  const [stack, setStack] = React.useState([]); // path segments\r\n  const [items, setItems] = React.useState([]);\r\n  const [sel, setSel] = React.useState(new Set());\r\n  const [loading, setLoading] = React.useState(false);\r\n\r\n  const rootName = React.useMemo(()=> (root ? (root.name || 'Folder') : ''), [root]);\r\n  const cwd = React.useMemo(()=> (stack.length ? stack.join('/') : '.'), [stack]);\r\n  const canGoUp = stack.length > 0;\r\n\r\n  async function pickRoot(){\r\n    try { const dir = await window.showDirectoryPicker(); setRoot(dir); setStack([]); setSel(new Set()); return true; } catch { return false; }\r\n  }\r\n\r\n  async function getDirHandle(){\r\n    if (!root) return null;\r\n    let h = root; for (const seg of stack){ h = await h.getDirectoryHandle(seg); }\r\n    return h;\r\n  }\r\n\r\n  async function list(dirRel = '.'){\r\n    if (!root) return; setLoading(true);\r\n    try {\r\n      if (dirRel !== '.' && dirRel) {\r\n        const parts = String(dirRel).split('/').filter(Boolean); setStack(parts);\r\n      }\r\n      const dir = await getDirHandle(); if (!dir) return;\r\n      const next = [];\r\n      for await (const [name, handle] of dir.entries()){\r\n        if (handle.kind === 'directory') next.push({ name, isDirectory: true, type: 'd' });\r\n        else { try { const file = await handle.getFile(); next.push({ name, isDirectory: false, type: 'f', size: file.size }); } catch { next.push({ name, isDirectory: false, type: 'f' }); }\r\n        }\r\n      }\r\n      next.sort((a,b)=> (a.isDirectory===b.isDirectory) ? a.name.localeCompare(b.name) : (a.isDirectory ? -1 : 1));\r\n      setItems(next); setSel(new Set());\r\n    } finally { setLoading(false); }\r\n  }\r\n\r\n  function goUp(){ if (!canGoUp) return; const arr = stack.slice(0,-1); setStack(arr); list(arr.join('/')||'.'); }\r\n\r\n  async function open(entry){ if (entry.isDirectory) { const next = [...stack, entry.name]; setStack(next); await list(next.join('/')); } else { const s = new Set([entry.name]); setSel(s); } }\r\n\r\n  function onRowClick(e, entry, index){ const ctrl = e.ctrlKey || e.metaKey; const shift = e.shiftKey; if (entry.isDirectory) return; if (shift) { /* simple: ignore for now */ } if (ctrl) { const n=new Set(sel); if(n.has(entry.name)) n.delete(entry.name); else n.add(entry.name); setSel(n); } else { setSel(new Set([entry.name])); } }\r\n\r\n  async function resolveFileHandle(rel){ let h = await getDirHandle(); const parts = String(rel).split('/').filter(Boolean); for (let i=0;i<parts.length;i++){ const seg=parts[i]; if (i === parts.length-1) { return h.getFileHandle(seg); } h = await h.getDirectoryHandle(seg); } }\r\n\r\n  async function gatherFiles(rel){ // returns [{rel, file}]\r\n    const out = [];\r\n    async function walk(dirRel){\r\n      const dir = await getDirHandle(); // base\r\n      // navigate to dirRel\r\n      let h = dir; if (dirRel && dirRel !== '.') { const segs = dirRel.split('/').filter(Boolean); for (const s of segs){ h = await h.getDirectoryHandle(s); } }\r\n      for await (const [name, handle] of h.entries()){\r\n        if (handle.kind === 'directory') await walk(dirRel && dirRel !== '.' ? `${dirRel}/${name}` : name);\r\n        else { const file = await handle.getFile(); out.push({ rel: (dirRel && dirRel !== '.' ? `${dirRel}/${name}` : name), file }); }\r\n      }\r\n    }\r\n    // rel may be file or directory\r\n    try {\r\n      const fh = await resolveFileHandle(rel).catch(()=>null);\r\n      if (fh) { const file = await (await fh).getFile(); out.push({ rel, file }); }\r\n      else { await walk(rel); }\r\n    } catch {}\r\n    return out;\r\n  }\r\n\r\n  async function uploadTo(dstPane, relPaths){\r\n    for (const rel of relPaths){\r\n      const files = await gatherFiles(rel);\r\n      for (const { rel: r, file } of files){\r\n        // ensure folder on dst\r\n        const parent = r.split('/').slice(0,-1).join('/');\r\n        if (parent) { try { await op(dstPane.conn.id, 'mkdir', { path: parent }); } catch(_){} }\r\n        const fd = new FormData(); fd.append('connectionId', dstPane.conn.id); fd.append('cwd', parent ? parent : dstPane.cwd || '.'); fd.append('file', file, r.split('/').pop());\r\n        await fetch('/unicon/api/stream/upload', { method:'POST', body: fd });\r\n      }\r\n    }\r\n  }\r\n\r\n  return { root, rootName, items, sel, setSel, loading, cwd, canGoUp, pickRoot, list, goUp, open, onRowClick, uploadTo };\r\n}\r\n\r\nfunction LocalPane({ pane, side }){\r\n  return (\r\n    <div className=\"flex-1 flex flex-col border rounded\" onDragOver={(e)=>e.preventDefault()}>\r\n      <div className=\"flex items-center gap-2 p-2 border-b\">\r\n        <Input className=\"flex-1\" value={pane.cwd} readOnly />\r\n        <Button variant=\"secondary\" onClick={()=>pane.goUp()} disabled={!pane.canGoUp}>Up</Button>\r\n      </div>\r\n      <div className=\"flex-1 overflow-auto\">\r\n        <table className=\"w-full text-sm\">\r\n          <thead className=\"bg-gray-50\"><tr><th className=\"w-6\"></th><th className=\"text-left px-2 py-1\">Name</th><th className=\"text-left px-2 py-1\">Type</th><th className=\"text-left px-2 py-1\">Size</th></tr></thead>\r\n          <tbody>\r\n            {pane.items.map((it,i)=>{\r\n              const checked = pane.sel.has(it.name);\r\n              return (\r\n                <tr key={i} className={`border-b ${checked?'bg-blue-50':''}`} draggable={!it.isDirectory} onDragStart={(e)=>{\r\n                  const names = pane.sel.has(it.name) ? Array.from(pane.sel) : [it.name];\r\n                  e.dataTransfer.setData('application/x-unicon-local', JSON.stringify({ relPaths: names }));\r\n                }} onClick={(e)=>pane.onRowClick(e, it, i)}>\r\n                  <td className=\"px-2 py-1\">{!it.isDirectory && (<input type=\"checkbox\" checked={checked} onChange={(e)=>{ e.stopPropagation(); const s=new Set(pane.sel); if(s.has(it.name)) s.delete(it.name); else s.add(it.name); pane.setSel(s); }} />)}</td>\r\n                  <td className=\"px-2 py-1\"><button className=\"hover:underline\" onClick={(e)=>{ e.stopPropagation(); pane.open(it); }}>{it.name}</button></td>\r\n                  <td className=\"px-2 py-1\">{it.isDirectory? 'dir':'file'}</td>\r\n                  <td className=\"px-2 py-1\">{it.size ?? ''}</td>\r\n                </tr>\r\n              );\r\n            })}\r\n            {!pane.items.length && (<tr><td className=\"px-3 py-6 text-center text-gray-500\" colSpan={4}>{pane.loading ? 'Loading…' : 'Empty'}</td></tr>)}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["usePane","conn","setConn","React","cwd","setCwd","items","setItems","sel","setSel","lastIndex","setLastIndex","loading","setLoading","list","dir","path","res","op","goUp","parts","open","entry","next","onRowClick","e","index","ctrl","a","b","names","x","Commander","left","right","localLeft","useLocalPane","useLocalLeft","setUseLocalLeft","all","setAll","busy","setBusy","progress","setProgress","queue","setQueue","paused","setPaused","processingRef","inflight","setInflight","reloadConns","listConnections","c","onWs","m","d","prev","ensureConnected","pane","connectConnection","norm","pathStr","join","parentDir","p","ensureDir","dirPath","n","acc","part","buildPlan","src","dst","files","totalBytes","base","byName","it","walk","absPath","relRoot","entries","absChild","relChild","size","name","abs","enqueueCopy","tasks","f","processQueue","task","r","copy","ConnPicker","jsxs","Select","_a","id","jsx","Button","disconnectConnection","Pane","side","onDropFromOther","onDropLocal","Input","fd","url","sLocal","payload","s","i","isDir","checked","v","LocalPane","relPaths","root","setRoot","stack","setStack","rootName","canGoUp","pickRoot","getDirHandle","h","seg","dirRel","handle","file","arr","resolveFileHandle","rel","gatherFiles","out","segs","fh","uploadTo","dstPane","parent"],"mappings":"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"}