{"version":3,"file":"Commander-9fLv4-Sw.js","sources":["../../src/workspaces/file-commander/Commander.jsx"],"sourcesContent":["// client/src/workspaces/file-commander/Commander.jsx\r\nimport React from 'react';\r\nimport { listConnections, connectConnection, disconnectConnection, op } from '../../lib/api';\r\nimport Button from '../../ui/Button.jsx';\r\nimport Input from '../../ui/Input.jsx';\r\nimport Select from '../../ui/Select.jsx';\r\n\r\nfunction usePane() {\r\n  const [conn, setConn] = React.useState(null);\r\n  const [cwd, setCwd] = React.useState('.');\r\n  const [items, setItems] = React.useState([]);\r\n  const [sel, setSel] = React.useState(new Set());\r\n  const [lastIndex, setLastIndex] = React.useState(-1);\r\n  const [loading, setLoading] = React.useState(false);\r\n\r\n  const list = React.useCallback(async (dir) => {\r\n    if (!conn || conn.status !== 'connected') return;\r\n    const path = dir ?? cwd;\r\n    setLoading(true);\r\n    try {\r\n      const res = await op(conn.id, 'list', { path });\r\n      if (res?.success) { setItems(res.data || []); setCwd(path); setSel(new Set()); setLastIndex(-1); }\r\n    } finally { setLoading(false); }\r\n  }, [conn, cwd]);\r\n\r\n  const goUp = () => {\r\n    if (!cwd || cwd === '.' || cwd === '/') { list('/'); return; }\r\n    const parts = String(cwd).replace(/\\\\+/g,'/').split('/'); parts.pop();\r\n    list(parts.join('/') || '/');\r\n  };\r\n\r\n  const open = (entry) => {\r\n    const isDir = entry.isDirectory === true || entry.type === 'd' || entry.type === 1;\r\n    if (isDir) {\r\n      const next = (cwd === '/' ? `/${entry.name}` : `${cwd}/${entry.name}`);\r\n      list(next);\r\n    } else {\r\n      // default single select\r\n      const next = new Set([entry.name]);\r\n      setSel(next);\r\n    }\r\n  };\r\n\r\n  function onRowClick(e, entry, index){\r\n    const isDir = entry.isDirectory === true || entry.type === 'd' || entry.type === 1;\r\n    if (isDir) return; // rows for files only affect selection; folder open via name click\r\n    const ctrl = e.ctrlKey || e.metaKey; const shift = e.shiftKey;\r\n    if (shift && lastIndex !== -1) {\r\n      const a = Math.min(lastIndex, index); const b = Math.max(lastIndex, index);\r\n      const names = items.slice(a, b+1).filter(x=>!(x.isDirectory===true || x.type==='d' || x.type===1)).map(x=>x.name);\r\n      setSel(new Set(names));\r\n    } else if (ctrl) {\r\n      const next = new Set(sel); if (next.has(entry.name)) next.delete(entry.name); else next.add(entry.name); setSel(next); setLastIndex(index);\r\n    } else {\r\n      setSel(new Set([entry.name])); setLastIndex(index);\r\n    }\r\n  }\r\n\r\n  return { conn, setConn, cwd, setCwd, items, sel, setSel, lastIndex, setLastIndex, list, goUp, open, loading, onRowClick };\r\n}\r\n\r\nasync function copyOne({ src, dst, name }) {\r\n  const srcPath = (src.cwd === '/' ? `/${name}` : `${src.cwd}/${name}`);\r\n  const dstPath = (dst.cwd === '/' ? `/${name}` : `${dst.cwd}/${name}`);\r\n  const dl = await op(src.conn.id, 'download', { path: srcPath });\r\n  if (!dl?.success) throw new Error(dl?.error || 'download failed');\r\n  const up = await op(dst.conn.id, 'upload', { path: dstPath, base64: dl.data?.base64 });\r\n  if (!up?.success) throw new Error(up?.error || 'upload failed');\r\n}\r\n\r\nexport default function Commander() {\r\n  const left = usePane();\r\n  const right = usePane();\r\n  const [all, setAll] = React.useState([]);\r\n  const [busy, setBusy] = React.useState(false);\r\n  const [progress, setProgress] = React.useState({ totalFiles: 0, doneFiles: 0, totalBytes: 0, doneBytes: 0, running: false, phase: '' });\r\n  const [queue, setQueue] = React.useState([]); // tasks: {srcConnId, dstConnId, srcPath, dstPath, size}\r\n  const [paused, setPaused] = React.useState(false);\r\n  const processingRef = React.useRef(false);\r\n\r\n  const reloadConns = async () => {\r\n    const d = await listConnections();\r\n    const list = (d.connections || []).filter(c => ['localfs','ftp','sftp'].includes(c.type));\r\n    setAll(list);\r\n  };\r\n  React.useEffect(() => { reloadConns(); }, []);\r\n\r\n  const ensureConnected = async (pane) => {\r\n    if (!pane.conn) return;\r\n    if (pane.conn.status !== 'connected') {\r\n      await connectConnection(pane.conn.id);\r\n      pane.setConn({ ...pane.conn, status: 'connected' });\r\n    }\r\n    await pane.list('.');\r\n  };\r\n\r\n  function norm(pathStr) { return String(pathStr || '').replace(/\\\\+/g,'/').replace(/\\/+/, '/'); }\r\n  function join(a,b){ if(!a||a==='.') return b||''; if(a.endsWith('/')) return b?`${a}${b}`:a; return b?`${a}/${b}`:a; }\r\n  function parentDir(p){ const n = norm(p); const parts = n.split('/'); parts.pop(); return parts.join('/') || '/'; }\r\n  async function ensureDir(pane, dirPath){ // create nested dirs, ignore errors\r\n    const n = norm(dirPath);\r\n    if (!n || n === '.' || n === '/') return;\r\n    const parts = n.split('/');\r\n    let acc = '';\r\n    for (const part of parts) {\r\n      acc = acc ? `${acc}/${part}` : part;\r\n      try { await op(pane.conn.id, 'mkdir', { path: acc }); } catch(_) { /* ignore */ }\r\n    }\r\n  }\r\n\r\n  async function buildPlan(src, dst, names){\r\n    const files = [];\r\n    let totalBytes = 0;\r\n    const base = norm(src.cwd);\r\n    const byName = new Map((src.items||[]).map(it=>[it.name,it]));\r\n    async function walk(absPath, relRoot){\r\n      const res = await op(src.conn.id, 'list', { path: absPath });\r\n      const entries = res?.data || [];\r\n      for (const e of entries){\r\n        const absChild = join(absPath, e.name);\r\n        const relChild = join(relRoot, e.name);\r\n        const isDir = e.isDirectory===true || e.type==='d' || e.type===1;\r\n        if (isDir){ await walk(absChild, relChild); }\r\n        else { const size = Number(e.size||0); totalBytes += size; files.push({ srcPath: absChild, rel: relChild, size }); }\r\n      }\r\n    }\r\n    for (const name of names){\r\n      const entry = byName.get(name);\r\n      const abs = join(base, name);\r\n      const isDir = entry && (entry.isDirectory===true || entry.type==='d' || entry.type===1);\r\n      if (isDir) { await walk(abs, name); }\r\n      else { const size = Number(entry?.size||0); totalBytes += size; files.push({ srcPath: abs, rel: name, size }); }\r\n    }\r\n    return { files, totalBytes };\r\n  }\r\n\r\n  async function enqueueCopy(src, dst, names){\r\n    // Build plan and push to queue\r\n    setProgress(p=>({ ...p, running: true, phase: p.running ? p.phase : 'Queued', totalFiles: p.totalFiles, totalBytes: p.totalBytes }));\r\n    const { files, totalBytes } = await buildPlan(src, dst, names);\r\n    const tasks = files.map(f => ({ srcConnId: src.conn.id, dstConnId: dst.conn.id, srcPath: f.srcPath, dstPath: join(dst.cwd, f.rel), size: f.size }));\r\n    setQueue(prev => [...prev, ...tasks]);\r\n    setProgress(prev => ({ ...prev, totalFiles: prev.totalFiles + tasks.length, totalBytes: prev.totalBytes + totalBytes }));\r\n    if (!processingRef.current && !paused) processQueue();\r\n  }\r\n\r\n  async function processQueue(){\r\n    processingRef.current = true;\r\n    setProgress(prev => ({ ...prev, running: true, phase: 'Copying…' }));\r\n    while (!paused) {\r\n      let task = null;\r\n      setQueue(prev => {\r\n        if (!prev.length) return prev; task = prev[0]; return prev.slice(1);\r\n      });\r\n      if (!task) break;\r\n      try {\r\n        // Ensure parent dir exists on dst\r\n        await ensureDir({ conn: { id: task.dstConnId } }, parentDir(task.dstPath.replace(/^\\/+/, '')));\r\n        const dl = await op(task.srcConnId, 'download', { path: task.srcPath });\r\n        if (!dl?.success) throw new Error(dl?.error || 'download failed');\r\n        await op(task.dstConnId, 'upload', { path: task.dstPath, base64: dl.data?.base64 });\r\n        setProgress(prev => ({ ...prev, doneFiles: prev.doneFiles + 1, doneBytes: Math.min(prev.totalBytes, prev.doneBytes + (task.size||0)) }));\r\n      } catch (e) {\r\n        alert(`Copy failed: ${e.message || e}`);\r\n      }\r\n    }\r\n    processingRef.current = false;\r\n    setProgress(prev => ({ ...prev, phase: paused ? 'Paused' : (queue.length ? 'Queued' : 'Done'), running: queue.length>0 || paused }));\r\n  }\r\n\r\n  const copy = async (src, dst) => {\r\n    if (!src.conn || !dst.conn) return;\r\n    const names = Array.from(src.sel);\r\n    if (!names.length) return;\r\n    setBusy(true);\r\n    try {\r\n      await enqueueCopy(src, dst, names);\r\n    } catch (e) { alert(e.message || 'enqueue failed'); }\r\n    finally { setBusy(false); }\r\n  };\r\n\r\n  const ConnPicker = ({ pane }) => (\r\n    <div className=\"flex items-center gap-2\">\r\n      <Select value={pane.conn?.id || ''} onChange={(e)=>{\r\n        const id = e.target.value; const c = all.find(x=>x.id===id) || null; pane.setConn(c); if (c?.status==='connected') pane.list('.');\r\n      }}>\r\n        <option value=\"\">Pick connection…</option>\r\n        {all.map(c => (<option key={c.id} value={c.id}>{c.type.toUpperCase()} • {c.name}</option>))}\r\n      </Select>\r\n      <Button variant=\"secondary\" onClick={()=>ensureConnected(pane)} disabled={!pane.conn || pane.conn.status==='connected'}>Connect</Button>\r\n      <Button variant=\"secondary\" onClick={async()=>{ if(!pane.conn) return; await disconnectConnection(pane.conn.id); pane.setConn({ ...pane.conn, status:'disconnected' }); }} disabled={!pane.conn || pane.conn.status!=='connected'}>Disconnect</Button>\r\n    </div>\r\n  );\r\n\r\n  const Pane = ({ pane, side, onDropFromOther }) => (\r\n    <div className=\"flex-1 flex flex-col border rounded\">\r\n      <div className=\"flex items-center gap-2 p-2 border-b\">\r\n        <Button variant=\"secondary\" onClick={pane.goUp}>Up</Button>\r\n        <Button variant=\"secondary\" onClick={()=>pane.list(pane.cwd)}>Refresh</Button>\r\n        <Input className=\"flex-1\" value={pane.cwd} onChange={e=>pane.setCwd(e.target.value)} />\r\n        <Button onClick={()=>pane.list(pane.cwd)} disabled={!pane.conn || pane.conn.status!=='connected'}>Go</Button>\r\n      </div>\r\n      <div className=\"flex-1 overflow-auto\" onDragOver={(e)=>e.preventDefault()} onDrop={(e)=>{\r\n        try {\r\n          const s = e.dataTransfer.getData('application/x-unicon');\r\n          if (!s) return;\r\n          const payload = JSON.parse(s);\r\n          if (payload.from && payload.from !== side && Array.isArray(payload.names) && payload.names.length){ onDropFromOther(payload.names, payload.from); }\r\n        } catch(_){}\r\n      }}>\r\n        <table className=\"w-full text-sm\">\r\n          <thead className=\"bg-gray-50\"><tr><th className=\"px-2 py-1 w-6\"></th><th className=\"text-left px-2 py-1\">Name</th><th className=\"text-left px-2 py-1\">Type</th><th className=\"text-left px-2 py-1\">Size</th></tr></thead>\r\n          <tbody>\r\n            {pane.items.map((it,i)=>{\r\n              const isDir = it.isDirectory===true || it.type==='d' || it.type===1; const checked = pane.sel.has(it.name);\r\n              return (\r\n                <tr key={i} className={`border-b ${checked?'bg-blue-50':''}`} draggable onDragStart={(e)=>{\r\n                  const names = pane.sel.has(it.name) ? Array.from(pane.sel) : [it.name];\r\n                  e.dataTransfer.setData('application/x-unicon', JSON.stringify({ from: side, names }));\r\n                }} onClick={(e)=>pane.onRowClick(e, it, i)}>\r\n                  <td className=\"px-2 py-1\">{!isDir && (<input type=\"checkbox\" checked={checked} onChange={(e)=>{ e.stopPropagation(); const s=new Set(pane.sel); if(s.has(it.name)) s.delete(it.name); else s.add(it.name); pane.setSel(s); }} />)}</td>\r\n                  <td className=\"px-2 py-1\"><button className=\"hover:underline\" onClick={(e)=>{ e.stopPropagation(); pane.open(it); }}>{it.name}</button></td>\r\n                  <td className=\"px-2 py-1\">{isDir? 'dir':'file'}</td>\r\n                  <td className=\"px-2 py-1\">{it.size ?? ''}</td>\r\n                </tr>\r\n              );\r\n            })}\r\n            {!pane.items.length && (<tr><td className=\"px-3 py-6 text-center text-gray-500\" colSpan={4}>{pane.loading ? 'Loading…' : 'Empty'}</td></tr>)}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col gap-3\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-2\"><b>File Commander</b></div>\r\n        <Button variant=\"secondary\" onClick={reloadConns}>Reload connections</Button>\r\n      </div>\r\n\r\n      <div className=\"flex items-center gap-6\">\r\n        <ConnPicker pane={left} />\r\n        <div className=\"flex items-center gap-3\">\r\n          <Button onClick={()=>copy(right, left)} disabled={busy || !right.sel.size}>← Copy</Button>\r\n          <Button onClick={()=>copy(left, right)} disabled={busy || !left.sel.size}>Copy →</Button>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Button variant=\"secondary\" onClick={()=>{ setPaused(true); setProgress(p=>({ ...p, phase:'Paused', running:true })); }} disabled={paused || (!progress.running && !queue.length)}>Pause</Button>\r\n            <Button variant=\"secondary\" onClick={()=>{ setPaused(false); if (!processingRef.current) processQueue(); }} disabled={!paused}>Resume</Button>\r\n            <Button variant=\"secondary\" onClick={()=>{ setQueue([]); setProgress(p=>({ ...p, running:false, phase:'Canceled' })); }} disabled={!queue.length && !progress.running}>Cancel</Button>\r\n          </div>\r\n          <div className=\"min-w-[260px] text-xs text-gray-700\">\r\n            <div className=\"w-full h-2 bg-gray-200 rounded overflow-hidden mb-1\">\r\n              <div className=\"h-2 bg-blue-600\" style={{ width: `${progress.totalBytes>0 ? Math.floor(100*(progress.doneBytes/Math.max(1,progress.totalBytes))) : Math.floor(100*(progress.doneFiles/Math.max(1,progress.totalFiles)))}%` }} />\r\n            </div>\r\n            <div>{progress.phase || (queue.length ? 'Queued' : '')} {progress.doneFiles}/{progress.totalFiles} files · {Math.round(progress.doneBytes/1024)} / {Math.round(Math.max(1,progress.totalBytes)/1024)} KB · Queue: {queue.length}</div>\r\n          </div>\r\n        </div>\r\n        <ConnPicker pane={right} />\r\n      </div>\r\n\r\n      <div className=\"flex gap-3 min-h-[400px]\">\r\n        <Pane side=\"left\" pane={left} onDropFromOther={(names)=>enqueueCopy(right,left,names)} />\r\n        <Pane side=\"right\" pane={right} onDropFromOther={(names)=>enqueueCopy(left,right,names)} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["usePane","conn","setConn","React","cwd","setCwd","items","setItems","sel","setSel","lastIndex","setLastIndex","loading","setLoading","list","dir","path","res","op","goUp","parts","open","entry","next","onRowClick","e","index","ctrl","a","b","names","x","Commander","left","right","all","setAll","busy","setBusy","progress","setProgress","queue","setQueue","paused","setPaused","processingRef","reloadConns","listConnections","c","ensureConnected","pane","connectConnection","norm","pathStr","join","parentDir","p","ensureDir","dirPath","n","acc","part","buildPlan","src","dst","files","totalBytes","base","byName","it","walk","absPath","relRoot","entries","absChild","relChild","size","name","abs","enqueueCopy","tasks","f","prev","processQueue","task","dl","_a","copy","ConnPicker","jsxs","Select","id","jsx","Button","disconnectConnection","Pane","side","onDropFromOther","Input","s","payload","i","isDir","checked"],"mappings":"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"}