{"version":3,"names":["axios","require","fs","promises","path","yaml","EnhancedRestHandler","constructor","connectionId","config","isConnected","openApiSpec","endpoints","schemas","security","connect","headers","buildHeaders","get","baseUrl","timeout","validateStatus","openApiUrl","openApiFile","loadOpenApiSpec","broadcast","type","data","status","success","hasOpenApi","length","error","Error","message","disconnect","specContent","console","log","response","filePath","join","__dirname","fileContent","readFile","endsWith","load","JSON","parse","parseOpenApiSpec","warn","components","securitySchemes","paths","pathKey","pathValue","Object","entries","methods","method","operation","push","toUpperCase","operationId","summary","description","tags","parameters","parseParameters","requestBody","parseRequestBody","responses","deprecated","sort","a","b","localeCompare","operationParams","pathParams","allParams","map","param","name","in","required","schema","example","content","mediaType","mediaContent","examples","request","endpoint","params","requestHeaders","url","keys","searchParams","URLSearchParams","forEach","key","value","undefined","append","toString","maxRedirects","includes","startTime","Date","now","duration","statusText","timestamp","toISOString","getEndpoints","tag","filter","ep","getTags","info","Set","add","Array","from","generateExampleRequest","find","queryParams","body","exampleValue","generateExampleValue","replace","contentTypes","primaryContentType","ct","providedExample","$ref","refPath","refSchema","itemExample","items","properties","obj","propSchema","format","enum","validateRequest","valid","errors","assign","authentication","token","Buffer","global","handleFileUpload","file","filename","uploadsDir","mkdir","recursive","writeFile","cleanupFile","unlink","module","exports"],"sources":["enhanced_rest_handler.js"],"sourcesContent":["// Enhanced REST Handler with OpenAPI/Swagger Support\n// server/handlers/enhanced-rest-handler.js\n\nconst axios = require('axios');\nconst fs = require('fs').promises;\nconst path = require('path');\nconst yaml = require('js-yaml');\n\nclass EnhancedRestHandler {\n  constructor(connectionId, config) {\n    this.connectionId = connectionId;\n    this.config = config;\n    this.isConnected = false;\n    this.openApiSpec = null;\n    this.endpoints = [];\n    this.schemas = {};\n    this.security = {};\n  }\n\n  async connect() {\n    try {\n      // Test basic connection\n      const headers = this.buildHeaders();\n      await axios.get(this.config.baseUrl, { \n        headers, \n        timeout: 10000,\n        validateStatus: () => true\n      });\n      \n      this.isConnected = true;\n      \n      // Try to load OpenAPI spec if provided\n      if (this.config.openApiUrl || this.config.openApiFile) {\n        await this.loadOpenApiSpec();\n      }\n      \n      this.broadcast({\n        type: 'connection_status',\n        data: { connectionId: this.connectionId, status: 'connected' }\n      });\n      \n      return { \n        success: true, \n        hasOpenApi: !!this.openApiSpec,\n        endpoints: this.endpoints.length \n      };\n    } catch (error) {\n      this.isConnected = false;\n      throw new Error(`REST connection failed: ${error.message}`);\n    }\n  }\n\n  async disconnect() {\n    this.isConnected = false;\n    this.openApiSpec = null;\n    this.endpoints = [];\n    this.schemas = {};\n    \n    this.broadcast({\n      type: 'connection_status',\n      data: { connectionId: this.connectionId, status: 'disconnected' }\n    });\n    return { success: true };\n  }\n\n  async loadOpenApiSpec() {\n    try {\n      let specContent;\n      \n      if (this.config.openApiUrl) {\n        // Load from URL\n        console.log(`Loading OpenAPI spec from URL: ${this.config.openApiUrl}`);\n        const response = await axios.get(this.config.openApiUrl, {\n          timeout: 15000,\n          headers: { 'Accept': 'application/json, application/yaml, text/yaml' }\n        });\n        specContent = response.data;\n      } else if (this.config.openApiFile) {\n        // Load from uploaded file\n        const filePath = path.join(__dirname, '../uploads', this.config.openApiFile);\n        const fileContent = await fs.readFile(filePath, 'utf8');\n        \n        // Parse YAML or JSON\n        if (this.config.openApiFile.endsWith('.yaml') || this.config.openApiFile.endsWith('.yml')) {\n          specContent = yaml.load(fileContent);\n        } else {\n          specContent = JSON.parse(fileContent);\n        }\n      }\n      \n      if (specContent) {\n        this.openApiSpec = specContent;\n        this.parseOpenApiSpec();\n        console.log(`OpenAPI spec loaded: ${this.endpoints.length} endpoints found`);\n      }\n    } catch (error) {\n      console.warn(`Failed to load OpenAPI spec: ${error.message}`);\n      // Don't fail connection if OpenAPI loading fails\n    }\n  }\n\n  parseOpenApiSpec() {\n    if (!this.openApiSpec) return;\n\n    this.endpoints = [];\n    this.schemas = this.openApiSpec.components?.schemas || {};\n    this.security = this.openApiSpec.components?.securitySchemes || {};\n\n    // Parse paths and operations\n    const paths = this.openApiSpec.paths || {};\n    \n    for (const [pathKey, pathValue] of Object.entries(paths)) {\n      const methods = ['get', 'post', 'put', 'delete', 'patch', 'head', 'options'];\n      \n      for (const method of methods) {\n        if (pathValue[method]) {\n          const operation = pathValue[method];\n          \n          this.endpoints.push({\n            method: method.toUpperCase(),\n            path: pathKey,\n            operationId: operation.operationId,\n            summary: operation.summary,\n            description: operation.description,\n            tags: operation.tags || [],\n            parameters: this.parseParameters(operation.parameters, pathValue.parameters),\n            requestBody: this.parseRequestBody(operation.requestBody),\n            responses: operation.responses || {},\n            security: operation.security || this.openApiSpec.security || [],\n            deprecated: operation.deprecated || false\n          });\n        }\n      }\n    }\n\n    // Sort endpoints by path and method\n    this.endpoints.sort((a, b) => {\n      if (a.path !== b.path) return a.path.localeCompare(b.path);\n      return a.method.localeCompare(b.method);\n    });\n  }\n\n  parseParameters(operationParams = [], pathParams = []) {\n    const allParams = [...(pathParams || []), ...(operationParams || [])];\n    \n    return allParams.map(param => ({\n      name: param.name,\n      in: param.in, // query, header, path, cookie\n      required: param.required || false,\n      schema: param.schema || {},\n      description: param.description,\n      example: param.example || param.schema?.example\n    }));\n  }\n\n  parseRequestBody(requestBody) {\n    if (!requestBody) return null;\n\n    const content = requestBody.content || {};\n    const schemas = {};\n\n    for (const [mediaType, mediaContent] of Object.entries(content)) {\n      schemas[mediaType] = {\n        schema: mediaContent.schema || {},\n        examples: mediaContent.examples || {}\n      };\n    }\n\n    return {\n      required: requestBody.required || false,\n      description: requestBody.description,\n      content: schemas\n    };\n  }\n\n  async request(method, endpoint, data = null, headers = {}, params = {}) {\n    if (!this.isConnected) throw new Error('Not connected');\n    \n    const requestHeaders = { ...this.buildHeaders(), ...headers };\n    let url = `${this.config.baseUrl}${endpoint}`;\n    \n    // Add query parameters\n    if (params && Object.keys(params).length > 0) {\n      const searchParams = new URLSearchParams();\n      Object.entries(params).forEach(([key, value]) => {\n        if (value !== null && value !== undefined && value !== '') {\n          searchParams.append(key, value);\n        }\n      });\n      if (searchParams.toString()) {\n        url += `?${searchParams.toString()}`;\n      }\n    }\n    \n    const config = {\n      method,\n      url,\n      headers: requestHeaders,\n      timeout: 30000,\n      maxRedirects: 5\n    };\n    \n    // Add request body for appropriate methods\n    if (data && ['POST', 'PUT', 'PATCH'].includes(method.toUpperCase())) {\n      config.data = data;\n    }\n    \n    const startTime = Date.now();\n    \n    try {\n      const response = await axios(config);\n      const duration = Date.now() - startTime;\n      \n      return {\n        success: true,\n        data: {\n          status: response.status,\n          statusText: response.statusText,\n          headers: response.headers,\n          data: response.data,\n          duration,\n          timestamp: new Date().toISOString(),\n          request: {\n            method,\n            url,\n            headers: requestHeaders,\n            data\n          }\n        }\n      };\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      \n      if (error.response) {\n        // Server responded with error status\n        return {\n          success: false,\n          data: {\n            status: error.response.status,\n            statusText: error.response.statusText,\n            headers: error.response.headers,\n            data: error.response.data,\n            duration,\n            timestamp: new Date().toISOString(),\n            request: {\n              method,\n              url,\n              headers: requestHeaders,\n              data\n            }\n          }\n        };\n      } else {\n        // Network or other error\n        throw new Error(`Request failed: ${error.message}`);\n      }\n    }\n  }\n\n  // Get available endpoints from OpenAPI spec\n  getEndpoints(tag = null) {\n    let endpoints = this.endpoints;\n    \n    if (tag) {\n      endpoints = endpoints.filter(ep => ep.tags.includes(tag));\n    }\n    \n    return {\n      success: true,\n      data: {\n        endpoints,\n        tags: this.getTags(),\n        hasOpenApi: !!this.openApiSpec,\n        info: this.openApiSpec?.info || {}\n      }\n    };\n  }\n\n  getTags() {\n    const tags = new Set();\n    this.endpoints.forEach(ep => {\n      ep.tags.forEach(tag => tags.add(tag));\n    });\n    return Array.from(tags).sort();\n  }\n\n  // Generate example request for an endpoint\n  generateExampleRequest(path, method) {\n    const endpoint = this.endpoints.find(ep => \n      ep.path === path && ep.method === method.toUpperCase()\n    );\n    \n    if (!endpoint) {\n      return { success: false, error: 'Endpoint not found' };\n    }\n\n    const example = {\n      method: endpoint.method,\n      path: endpoint.path,\n      headers: {},\n      queryParams: {},\n      pathParams: {},\n      body: null\n    };\n\n    // Generate example parameters\n    endpoint.parameters?.forEach(param => {\n      const exampleValue = this.generateExampleValue(param.schema, param.example);\n      \n      switch (param.in) {\n        case 'query':\n          example.queryParams[param.name] = exampleValue;\n          break;\n        case 'header':\n          example.headers[param.name] = exampleValue;\n          break;\n        case 'path':\n          example.pathParams[param.name] = exampleValue;\n          example.path = example.path.replace(`{${param.name}}`, exampleValue);\n          break;\n      }\n    });\n\n    // Generate example request body\n    if (endpoint.requestBody) {\n      const contentTypes = Object.keys(endpoint.requestBody.content);\n      const primaryContentType = contentTypes.find(ct => ct.includes('json')) || contentTypes[0];\n      \n      if (primaryContentType) {\n        const schema = endpoint.requestBody.content[primaryContentType].schema;\n        example.body = this.generateExampleValue(schema);\n        example.headers['Content-Type'] = primaryContentType;\n      }\n    }\n\n    return { success: true, data: example };\n  }\n\n  generateExampleValue(schema, providedExample = null) {\n    if (providedExample !== null && providedExample !== undefined) {\n      return providedExample;\n    }\n\n    if (!schema) return null;\n\n    // Handle $ref\n    if (schema.$ref) {\n      const refPath = schema.$ref.replace('#/components/schemas/', '');\n      const refSchema = this.schemas[refPath];\n      if (refSchema) {\n        return this.generateExampleValue(refSchema);\n      }\n    }\n\n    // Handle arrays\n    if (schema.type === 'array') {\n      const itemExample = this.generateExampleValue(schema.items);\n      return [itemExample];\n    }\n\n    // Handle objects\n    if (schema.type === 'object' || schema.properties) {\n      const obj = {};\n      if (schema.properties) {\n        Object.entries(schema.properties).forEach(([key, propSchema]) => {\n          obj[key] = this.generateExampleValue(propSchema);\n        });\n      }\n      return obj;\n    }\n\n    // Handle primitives\n    switch (schema.type) {\n      case 'string':\n        if (schema.format === 'email') return 'user@example.com';\n        if (schema.format === 'date') return '2024-01-01';\n        if (schema.format === 'date-time') return '2024-01-01T12:00:00Z';\n        if (schema.format === 'uuid') return '123e4567-e89b-12d3-a456-426614174000';\n        if (schema.enum) return schema.enum[0];\n        return schema.example || 'example string';\n      \n      case 'number':\n      case 'integer':\n        return schema.example || 42;\n      \n      case 'boolean':\n        return schema.example !== undefined ? schema.example : true;\n      \n      default:\n        return schema.example || null;\n    }\n  }\n\n  // Validate request against OpenAPI spec\n  validateRequest(path, method, headers = {}, params = {}, body = null) {\n    const endpoint = this.endpoints.find(ep => \n      ep.path === path && ep.method === method.toUpperCase()\n    );\n    \n    if (!endpoint) {\n      return { valid: false, errors: ['Endpoint not found in OpenAPI specification'] };\n    }\n\n    const errors = [];\n\n    // Validate required parameters\n    endpoint.parameters?.forEach(param => {\n      if (param.required) {\n        let value;\n        switch (param.in) {\n          case 'query':\n            value = params[param.name];\n            break;\n          case 'header':\n            value = headers[param.name];\n            break;\n          case 'path':\n            // Path params should be in the URL\n            break;\n        }\n\n        if (value === null || value === undefined || value === '') {\n          errors.push(`Required parameter '${param.name}' (${param.in}) is missing`);\n        }\n      }\n    });\n\n    // Validate request body\n    if (endpoint.requestBody?.required && !body) {\n      errors.push('Request body is required but not provided');\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors,\n      endpoint: {\n        summary: endpoint.summary,\n        description: endpoint.description,\n        tags: endpoint.tags\n      }\n    };\n  }\n\n  buildHeaders() {\n    const headers = {};\n    \n    // Default headers\n    if (this.config.headers) {\n      try {\n        Object.assign(headers, JSON.parse(this.config.headers));\n      } catch (error) {\n        console.warn('Invalid headers JSON:', error);\n      }\n    }\n    \n    // Authentication headers\n    switch (this.config.authentication) {\n      case 'Bearer Token':\n        if (this.config.token) {\n          headers['Authorization'] = `Bearer ${this.config.token}`;\n        }\n        break;\n      case 'API Key':\n        if (this.config.token) {\n          headers['X-API-Key'] = this.config.token;\n        }\n        break;\n      case 'Basic Auth':\n        if (this.config.token) {\n          // Expect token in format \"username:password\"\n          headers['Authorization'] = `Basic ${Buffer.from(this.config.token).toString('base64')}`;\n        }\n        break;\n    }\n    \n    return headers;\n  }\n\n  broadcast(message) {\n    // Placeholder for WebSocket broadcasting\n    // Should be implemented by the main server\n    if (global.broadcast) {\n      global.broadcast(message);\n    }\n  }\n\n  // File upload handling for OpenAPI specs\n  static async handleFileUpload(file, filename) {\n    const uploadsDir = path.join(__dirname, '../uploads');\n    \n    // Ensure uploads directory exists\n    try {\n      await fs.mkdir(uploadsDir, { recursive: true });\n    } catch (error) {\n      // Directory already exists\n    }\n    \n    const filePath = path.join(uploadsDir, filename);\n    await fs.writeFile(filePath, file);\n    \n    return filename;\n  }\n\n  // Cleanup uploaded files\n  static async cleanupFile(filename) {\n    try {\n      const filePath = path.join(__dirname, '../uploads', filename);\n      await fs.unlink(filePath);\n    } catch (error) {\n      console.warn(`Failed to cleanup file ${filename}:`, error.message);\n    }\n  }\n}\n\nmodule.exports = EnhancedRestHandler;"],"mappings":"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","ignoreList":[]}