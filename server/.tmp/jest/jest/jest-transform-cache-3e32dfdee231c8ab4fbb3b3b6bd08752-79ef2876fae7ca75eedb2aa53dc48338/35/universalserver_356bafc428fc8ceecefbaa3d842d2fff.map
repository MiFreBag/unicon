{"version":3,"names":["express","require","cors","WebSocket","v4","uuidv4","path","fs","crypto","multer","EnhancedRestHandler","verifyJWTMiddleware","verifyJWT","_","K8sHandler","WSHandler","SQLHandler","SSHHandler","OPCUAHandler","GrpcHandler","DEFAULT_ALLOWED_ORIGINS","PORT","process","env","WS_PORT","DATA_DIR","CONNECTION_DATA_DIR","join","__dirname","CONNECTIONS_FILE","PERSISTENCE","SQLITE_DB_PATH","parseAllowedOrigins","envOrigins","ALLOWED_ORIGINS","split","map","origin","trim","filter","Boolean","length","ensureDataStore","existsSync","mkdirSync","recursive","normalizeConnection","connection","id","name","type","config","createdAt","Date","toISOString","status","loadConnections","db","getConnections","raw","readFileSync","parsed","JSON","parse","list","Array","isArray","connections","error","console","persistConnections","replaceConnections","payload","promises","writeFile","stringify","DB","buildState","init","activeConnections","Map","connectedClients","Set","createBroadcast","message","forEach","client","readyState","OPEN","send","createCorsMiddleware","allowedOrigins","callback","includes","Error","credentials","createApp","state","broadcast","global","app","use","json","limit","upload","storage","memoryStorage","limits","fileSize","apiRouter","Router","enableCsp","ENABLE_CSP","ELECTRON","NODE_ENV","frameAncestors","CSP_FRAME_ANCESTORS","wsConnect","connectSrc","inProd","scriptSrc","csp","req","res","next","setHeader","FEATURE_AUTH","createAuthRouter","requireRoles","get","profile","email","user","roles","provider","getUserPref","sub","avatar","success","e","post","setUserPref","body","lang","pong","warn","IN_TEST","JEST_WORKER_ID","ENFORCE","AUTH_ENFORCE","fresh","splice","push","data","delete","connectionId","params","has","index","findIndex","conn","find","c","handler","connect","set","active","disconnect","timestamp","size","operation","method","endpoint","headers","q","result","request","getEndpoints","tag","p","validateRequest","generateExampleRequest","openApiUrl","openApiFile","loadOpenApiSpec","h","browse","nodeId","read","nodes","write","value","dataType","ping","browseTopics","topicPattern","beginTopicName","reverse","getLatestData","topicPatterns","filterDef","simpleSubscribe","subscribe","subsConfig","unsubscribe","publish","topic","publishUpdate","deltaPublish","publishDeltaToDelta","publishDeltaToFull","publishFullToDelta","sendTopic","unary","command","cwd","exec","shellOpen","cols","rows","shellInput","sessionId","shellResize","shellClose","sftpList","sftpGet","sftpPut","base64","sql","query","listContexts","useContext","listNamespaces","listPods","namespace","logsStart","pod","container","tailLines","logsStop","execOpen","tty","execInput","execClose","single","file","filename","originalname","handleFileUpload","buffer","incoming","importedConnections","item","clear","count","pkceStore","pkceExpireMs","b64url","buf","toString","replace","makeVerifier","randomBytes","makeChallenge","verifier","createHash","update","digest","GOOGLE","auth","token","userinfo","client_id","GOOGLE_CLIENT_ID","client_secret","GOOGLE_CLIENT_SECRET","scope","GITHUB","emails","GITHUB_CLIENT_ID","GITHUB_CLIENT_SECRET","providerByName","challenge","redirectUri","protocol","exp","now","html","encodeURIComponent","entry","URLSearchParams","response_type","redirect_uri","code_challenge","code_challenge_method","access_type","redirect","code","axios","tokenResp","grant_type","Accept","code_verifier","accessToken","access_token","providerName","u","Authorization","picture","avatar_url","x","primary","dbi","getUserByEmail","createUser","password_hash","salt","assignRoleToUser","localCode","oauthCodes","userEmail","clientRedirect","sep","okClient","okRedirect","test","consent","Math","random","slice","issueJWT","token_type","expires_in","static","nonce","current","getHeader","updated","sendFile","version","createWebSocketServer","customPort","wsServer","Server","port","host","on","ws","add","__RUNNING","server","startServers","close","Promise","resolvedState","then","httpPort","Number","wsPort","listen","log","shutdown","exit","main","module","exports"],"sources":["universal-server.js"],"sourcesContent":["const express = require('express');\r\nconst cors = require('cors');\r\nconst WebSocket = require('ws');\r\nconst { v4: uuidv4 } = require('uuid');\r\nconst path = require('path');\r\nconst fs = require('fs');\r\nconst crypto = require('crypto');\r\nconst multer = require('multer');\r\nconst EnhancedRestHandler = require('./handlers/enhanced_rest_handler');\r\nlet verifyJWTMiddleware = null;\r\ntry { verifyJWTMiddleware = require('./auth/middleware').verifyJWT; } catch (_) { /* auth not enabled */ }\r\nconst K8sHandler = require('./handlers/k8s_handler');\r\nconst WSHandler = require('./handlers/ws_handler');\r\nconst SQLHandler = require('./handlers/sql_handler');\r\nconst SSHHandler = require('./handlers/ssh_handler');\r\nconst OPCUAHandler = require('./handlers/opcua_handler');\r\nconst GrpcHandler = require('./handlers/grpc_handler');\r\n\r\nconst DEFAULT_ALLOWED_ORIGINS = [\r\n  'http://localhost',\r\n  'http://localhost:80',\r\n  'http://localhost:4173',\r\n  'http://localhost:5174',\r\n  'http://10.1.3.231:5174',\r\n  'http://127.0.0.1',\r\n  'http://127.0.0.1:80'\r\n];\r\n\r\nconst PORT = process.env.PORT || 3001;\r\nconst WS_PORT = process.env.WS_PORT || 8080;\r\nconst DATA_DIR = process.env.CONNECTION_DATA_DIR || path.join(__dirname, 'data');\r\nconst CONNECTIONS_FILE = path.join(DATA_DIR, 'connections.json');\r\nconst PERSISTENCE = process.env.PERSISTENCE || 'file';\r\nconst SQLITE_DB_PATH = path.join(DATA_DIR, 'unicon.db');\r\n\r\nconst parseAllowedOrigins = () => {\r\n  const envOrigins = process.env.ALLOWED_ORIGINS\r\n    ? process.env.ALLOWED_ORIGINS.split(',').map(origin => origin.trim()).filter(Boolean)\r\n    : [];\r\n\r\n  return envOrigins.length > 0 ? envOrigins : DEFAULT_ALLOWED_ORIGINS;\r\n};\r\n\r\nconst ensureDataStore = () => {\r\n  if (!fs.existsSync(DATA_DIR)) {\r\n    fs.mkdirSync(DATA_DIR, { recursive: true });\r\n  }\r\n};\r\n\r\nconst normalizeConnection = (connection) => ({\r\n  id: connection.id || uuidv4(),\r\n  name: connection.name || 'Unbenannte Verbindung',\r\n  type: connection.type || 'unknown',\r\n  config: connection.config || {},\r\n  createdAt: connection.createdAt || new Date().toISOString(),\r\n  status: connection.status || 'disconnected'\r\n});\r\n\r\nconst loadConnections = async (db) => {\r\n  try {\r\n    ensureDataStore();\r\n\r\n    if (PERSISTENCE === 'sqlite' && db) {\r\n      return await db.getConnections();\r\n    }\r\n\r\n    if (!fs.existsSync(CONNECTIONS_FILE)) {\r\n      return [];\r\n    }\r\n\r\n    const raw = fs.readFileSync(CONNECTIONS_FILE, 'utf8');\r\n    if (!raw) return [];\r\n\r\n    const parsed = JSON.parse(raw);\r\n    const list = Array.isArray(parsed) ? parsed : parsed.connections;\r\n\r\n    if (!Array.isArray(list)) return [];\r\n\r\n    return list.map(normalizeConnection).map(connection => ({\r\n      ...connection,\r\n      status: 'disconnected'\r\n    }));\r\n  } catch (error) {\r\n    console.error('Failed to load connections store:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\nconst persistConnections = async (connections, db) => {\r\n  ensureDataStore();\r\n\r\n  if (PERSISTENCE === 'sqlite' && db) {\r\n    await db.replaceConnections(connections.map(normalizeConnection));\r\n    return;\r\n  }\r\n\r\n  const payload = {\r\n    connections: connections.map(normalizeConnection)\r\n  };\r\n\r\n  await fs.promises.writeFile(CONNECTIONS_FILE, JSON.stringify(payload, null, 2), 'utf8');\r\n};\r\n\r\nconst { DB } = (() => {\r\n  try { return require('./persistence/db'); } catch { return { DB: null }; }\r\n})();\r\n\r\nconst buildState = async () => {\r\n  let db = null;\r\n  if (PERSISTENCE === 'sqlite' && DB) {\r\n    db = await new DB(SQLITE_DB_PATH).init();\r\n  }\r\n  const connections = await loadConnections(db);\r\n  return {\r\n    connections,\r\n    activeConnections: new Map(),\r\n    connectedClients: new Set(),\r\n    db,\r\n  };\r\n};\r\n\r\nconst createBroadcast = connectedClients => message => {\r\n  connectedClients.forEach(client => {\r\n    if (client.readyState === WebSocket.OPEN) {\r\n      client.send(JSON.stringify(message));\r\n    }\r\n  });\r\n};\r\n\r\nconst createCorsMiddleware = allowedOrigins => cors({\r\n  origin: (origin, callback) => {\r\n    if (!origin || allowedOrigins.includes(origin)) {\r\n      callback(null, true);\r\n    } else {\r\n      callback(new Error(`Origin ${origin} not allowed by CORS`));\r\n    }\r\n  },\r\n  credentials: true\r\n});\r\n\r\nconst createApp = (state) => {\r\n  const { connections, activeConnections, connectedClients, db } = state;\r\n  const allowedOrigins = parseAllowedOrigins();\r\n  const broadcast = createBroadcast(connectedClients);\r\n  // make broadcast visible to handlers\r\n  global.broadcast = broadcast;\r\n\r\n  const app = express();\r\n  app.use(createCorsMiddleware(allowedOrigins));\r\n  app.use(express.json({ limit: '10mb' }));\r\n\r\n  // in-memory upload storage for OpenAPI files\r\n  const upload = multer({ storage: multer.memoryStorage(), limits: { fileSize: 15 * 1024 * 1024 } });\r\n\r\n  const apiRouter = express.Router();\r\n\r\n  // Add CSP for production/Electron when serving static /unicon content\r\n  const enableCsp = process.env.ENABLE_CSP === '1' || process.env.ELECTRON === '1' || process.env.NODE_ENV === 'production';\r\n  if (enableCsp) {\r\n    const frameAncestors = process.env.CSP_FRAME_ANCESTORS || \"'self'\"; // e.g., 'self' or 'none'\r\n    const wsConnect = `ws://localhost:${WS_PORT}`;\r\n    const connectSrc = [\"'self'\", `http://localhost:${PORT}`, wsConnect, 'http://localhost:5174', 'ws://localhost:5174'].join(' ');\r\n    const inProd = process.env.NODE_ENV === 'production' || process.env.ELECTRON === '1';\r\n    const scriptSrc = inProd ? \"script-src 'self'\" : \"script-src 'self' 'unsafe-eval'\"; // keep eval only in dev\r\n    const csp = [\r\n      \"default-src 'self'\",\r\n      \"base-uri 'self'\",\r\n      \"form-action 'self'\",\r\n      \"object-src 'none'\",\r\n      `frame-ancestors ${frameAncestors}`,\r\n      \"img-src 'self' data: blob:\",\r\n      \"font-src 'self' data:\",\r\n      \"style-src 'self' 'unsafe-inline'\",\r\n      scriptSrc,\r\n      `connect-src ${connectSrc}`\r\n    ].join('; ');\r\n    app.use('/unicon', (req, res, next) => {\r\n      res.setHeader('Content-Security-Policy', csp);\r\n      res.setHeader('X-Content-Type-Options', 'nosniff');\r\n      res.setHeader('Referrer-Policy', 'no-referrer');\r\n      res.setHeader('Permissions-Policy', 'camera=(), microphone=(), geolocation=()');\r\n      next();\r\n    });\r\n  }\r\n\r\n  // Optional Phase 1 auth scaffolding (disabled by default)\r\n  if (process.env.FEATURE_AUTH === '1') {\r\n    try {\r\n      const createAuthRouter = require('./auth/router');\r\n      const { verifyJWT, requireRoles } = require('./auth/middleware');\r\n      app.use('/unicon/api/auth', createAuthRouter(db));\r\n      // Example protected route\r\n      app.get('/unicon/api/me', verifyJWT, async (req, res) => {\r\n        try {\r\n          let profile = { email: req.user.email, roles: req.user.roles };\r\n          if (db) {\r\n            profile.provider = await db.getUserPref(req.user.sub, 'provider');\r\n            profile.avatar = await db.getUserPref(req.user.sub, 'avatar');\r\n          }\r\n          res.json({ success: true, user: profile });\r\n        } catch(e) { res.status(500).json({ success:false, error: e.message }); }\r\n      });\r\n      // User preferences: language\r\n      app.post('/unicon/api/settings/language', verifyJWT, async (req, res) => {\r\n        try {\r\n          await db.setUserPref(req.user.sub, 'lang', req.body?.lang || 'en');\r\n          res.json({ success: true });\r\n        } catch (e) { res.status(500).json({ success: false, error: e.message }); }\r\n      });\r\n      app.get('/unicon/api/settings/language', verifyJWT, async (req, res) => {\r\n        try { const lang = await db.getUserPref(req.user.sub, 'lang'); res.json({ success: true, lang }); }\r\n        catch (e) { res.status(500).json({ success: false, error: e.message }); }\r\n      });\r\n      // Example admin-only route\r\n      app.get('/unicon/api/admin/ping', verifyJWT, requireRoles('admin'), (req, res) => res.json({ success: true, pong: true }));\r\n    } catch (e) {\r\n      console.warn('Auth router not available:', e.message);\r\n    }\r\n  }\r\n\r\n  // In tests, never enforce auth; otherwise only when AUTH_ENFORCE=1 is set\r\n  const IN_TEST = process.env.NODE_ENV === 'test' || !!process.env.JEST_WORKER_ID;\r\n  const ENFORCE = !IN_TEST && process.env.AUTH_ENFORCE === '1' && typeof verifyJWTMiddleware === 'function';\r\n\r\n  apiRouter.get('/connections', ENFORCE ? verifyJWTMiddleware : (req,res,next)=>next(), async (req, res) => {\r\n    try {\r\n      if (db) {\r\n        const fresh = await db.getConnections();\r\n        connections.splice(0, connections.length, ...fresh);\r\n      }\r\n      res.json({ success: true, connections });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  });\r\n\r\n  apiRouter.post('/connections', ENFORCE ? verifyJWTMiddleware : (req,res,next)=>next(), async (req, res) => {\r\n    try {\r\n      const connection = {\r\n        id: uuidv4(),\r\n        ...req.body,\r\n        createdAt: new Date().toISOString(),\r\n        status: 'disconnected'\r\n      };\r\n\r\n      connections.push(connection);\r\n\r\n      await persistConnections(connections, db);\r\n\r\n      broadcast({\r\n        type: 'log',\r\n        data: { message: `Connection \"${connection.name}\" erstellt`, type: 'success' }\r\n      });\r\n\r\n      res.json({ success: true, connection });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  });\r\n\r\n  apiRouter.delete('/connections/:id', ENFORCE ? verifyJWTMiddleware : (req,res,next)=>next(), async (req, res) => {\r\n    try {\r\n      const connectionId = req.params.id;\r\n      if (activeConnections.has(connectionId)) {\r\n        activeConnections.delete(connectionId);\r\n      }\r\n\r\n      const index = connections.findIndex(conn => conn.id === connectionId);\r\n      if (index === -1) {\r\n        return res.status(404).json({ success: false, error: 'Connection not found' });\r\n      }\r\n\r\n      connections.splice(index, 1);\r\n\r\n      await persistConnections(connections, db);\r\n\r\n      broadcast({\r\n        type: 'log',\r\n        data: { message: 'Connection gelÃ¶scht', type: 'info' }\r\n      });\r\n\r\n      res.json({ success: true });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  });\r\n\r\n  apiRouter.post('/connect', ENFORCE ? verifyJWTMiddleware : (req,res,next)=>next(), async (req, res) => {\r\n    try {\r\n      const { connectionId } = req.body;\r\n      const connection = connections.find(c => c.id === connectionId);\r\n\r\n      if (!connection) {\r\n        return res.status(404).json({ success: false, error: 'Connection not found' });\r\n      }\r\n\r\n      // Create protocol handler when applicable\r\n      let handler = null;\r\n      if (connection.type === 'rest') {\r\n        handler = new EnhancedRestHandler(connection.id, connection.config || {});\r\n        await handler.connect();\r\n      } else if (connection.type === 'ssh') {\r\n        handler = new SSHHandler(connection.id, connection.config || {});\r\n        await handler.connect();\r\n      } else if (connection.type === 'k8s') {\r\n        handler = new K8sHandler(connection.id, connection.config || {});\r\n        await handler.connect();\r\n      } else if (connection.type === 'websocket') {\r\n        handler = new WSHandler(connection.id, connection.config || {});\r\n        await handler.connect();\r\n      } else if (connection.type === 'sql') {\r\n        handler = new SQLHandler(connection.id, connection.config || {});\r\n        await handler.connect();\r\n      } else if (connection.type === 'opcua' || connection.type === 'opc-ua') {\r\n        handler = new OPCUAHandler(connection.id, connection.config || {});\r\n        await handler.connect();\r\n      } else if (connection.type === 'grpc') {\r\n        handler = new GrpcHandler(connection.id, connection.config || {});\r\n        await handler.connect();\r\n      }\r\n\r\n      connection.status = 'connected';\r\n      activeConnections.set(connectionId, { status: 'connected', handler, type: connection.type });\r\n\r\n      await persistConnections(connections, db);\r\n\r\n      broadcast({ type: 'connection_status', data: { connectionId, status: 'connected' } });\r\n      broadcast({ type: 'log', data: { message: `Verbunden mit ${connection.name}`, type: 'success' } });\r\n\r\n      res.json({ success: true });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  });\r\n\r\n  apiRouter.post('/disconnect', ENFORCE ? verifyJWTMiddleware : (req,res,next)=>next(), async (req, res) => {\r\n    try {\r\n      const { connectionId } = req.body;\r\n      const connection = connections.find(c => c.id === connectionId);\r\n\r\n      if (!connection) {\r\n        return res.status(404).json({ success: false, error: 'Connection not found' });\r\n      }\r\n\r\n      const active = activeConnections.get(connectionId);\r\n      if (active?.handler?.disconnect) {\r\n        try { await active.handler.disconnect(); } catch (_) {}\r\n      }\r\n\r\n      connection.status = 'disconnected';\r\n      activeConnections.delete(connectionId);\r\n\r\n      await persistConnections(connections, db);\r\n\r\n      broadcast({ type: 'connection_status', data: { connectionId, status: 'disconnected' } });\r\n      broadcast({ type: 'log', data: { message: 'Verbindung getrennt', type: 'info' } });\r\n\r\n      res.json({ success: true });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  });\r\n\r\n  apiRouter.get('/health', (req, res) => {\r\n    res.json({\r\n      success: true,\r\n      status: 'healthy',\r\n      timestamp: new Date().toISOString(),\r\n      connections: connections.length,\r\n      activeConnections: activeConnections.size,\r\n      connectedClients: connectedClients.size\r\n    });\r\n  });\r\n\r\n  apiRouter.get('/connections/export', ENFORCE ? verifyJWTMiddleware : (req,res,next)=>next(), (req, res) => {\r\n    try {\r\n      res.setHeader('Content-Disposition', 'attachment; filename=\"connections-export.json\"');\r\n      res.json({ success: true, connections: connections.map(normalizeConnection) });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  });\r\n\r\n  // Unified operation endpoint used by the UI\r\n  apiRouter.post('/operation', ENFORCE ? verifyJWTMiddleware : (req,res,next)=>next(), async (req, res) => {\r\n    try {\r\n      const { connectionId, operation, params = {} } = req.body || {};\r\n      if (!connectionId || !operation) {\r\n        return res.status(400).json({ success: false, error: 'connectionId and operation required' });\r\n      }\r\n      const connection = connections.find(c => c.id === connectionId);\r\n      const active = activeConnections.get(connectionId);\r\n      if (!connection || connection.status !== 'connected' || !active) {\r\n        return res.status(400).json({ success: false, error: 'Connection not active' });\r\n      }\r\n\r\n      if (connection.type === 'rest' && active.handler) {\r\n        switch (operation) {\r\n          case 'request': {\r\n            const { method = 'GET', endpoint = '/', data = null, headers = {}, params: q = {} } = params;\r\n            const result = await active.handler.request(method, endpoint, data, headers, q);\r\n            return res.json(result);\r\n          }\r\n          case 'getEndpoints': {\r\n            const result = active.handler.getEndpoints(params.tag || null);\r\n            return res.json(result);\r\n          }\r\n          case 'validateRequest': {\r\n            const { path: p, method, headers = {}, params: q = {}, body = null } = params;\r\n            const result = active.handler.validateRequest(p, method, headers, q, body);\r\n            return res.json({ success: true, data: result });\r\n          }\r\n          case 'generateExample': {\r\n            const { path: p, method } = params;\r\n            const result = active.handler.generateExampleRequest(p, method);\r\n            return res.json(result);\r\n          }\r\n          case 'loadOpenApi': {\r\n            if (params.openApiUrl) active.handler.config.openApiUrl = params.openApiUrl;\r\n            if (params.openApiFile) active.handler.config.openApiFile = params.openApiFile;\r\n            await active.handler.loadOpenApiSpec();\r\n            return res.json({ success: true });\r\n          }\r\n          default:\r\n            return res.status(400).json({ success: false, error: `Unknown operation: ${operation}` });\r\n        }\r\n      }\r\n\r\n\r\n      // OPC UA operations\r\n      if ((connection.type === 'opcua' || connection.type === 'opc-ua') && active.handler) {\r\n        const h = active.handler;\r\n        switch (operation) {\r\n          case 'browse':\r\n            return res.json(await h.browse(params.nodeId));\r\n          case 'read':\r\n            return res.json(await h.read(params.nodes));\r\n          case 'write':\r\n            return res.json(await h.write(params.nodeId, params.value, params.dataType));\r\n          default:\r\n            return res.status(400).json({ success: false, error: `Unknown OPC UA operation: ${operation}` });\r\n        }\r\n      }\r\n\r\n      // CPD operations\r\n      if (connection.type === 'cpd' && active.handler) {\r\n        const h = active.handler;\r\n        switch (operation) {\r\n          case 'ping':\r\n            return res.json(await h.ping(params?.message || 'ping'));\r\n          case 'browseTopics':\r\n            return res.json(await h.browseTopics({\r\n              topicPattern: params?.topicPattern,\r\n              limit: params?.limit,\r\n              beginTopicName: params?.beginTopicName,\r\n              reverse: params?.reverse\r\n            }));\r\n          case 'getLatestData':\r\n            return res.json(await h.getLatestData({ topicPatterns: params?.topicPatterns, filterDef: params?.filterDef }));\r\n          case 'simpleSubscribe':\r\n            return res.json(await h.simpleSubscribe({ id: params?.id, topicPatterns: params?.topicPatterns }));\r\n          case 'subscribe':\r\n            return res.json(await h.subscribe({ id: params?.id, filterDef: params?.filterDef, subsConfig: params?.config || params?.subsConfig }));\r\n          case 'unsubscribe':\r\n            return res.json(await h.unsubscribe({ id: params?.id }));\r\n          case 'publish':\r\n            return res.json(await h.publish({ topic: params?.topic, data: params?.data }));\r\n          case 'publishUpdate':\r\n            return res.json(await h.publishUpdate({ topic: params?.topic, data: params?.data }));\r\n          case 'deltaPublish':\r\n            return res.json(await h.deltaPublish({ topic: params?.topic, data: params?.data }));\r\n          case 'publishDeltaToDelta':\r\n            return res.json(await h.publishDeltaToDelta({ topic: params?.topic, data: params?.data }));\r\n          case 'publishDeltaToFull':\r\n            return res.json(await h.publishDeltaToFull({ topic: params?.topic, data: params?.data }));\r\n          case 'publishFullToDelta':\r\n            return res.json(await h.publishFullToDelta({ topic: params?.topic, data: params?.data }));\r\n          case 'sendTopic':\r\n            return res.json(await h.sendTopic({ topic: params?.topic, data: params?.data }));\r\n          default:\r\n            return res.status(400).json({ success: false, error: `Unknown CPD operation: ${operation}` });\r\n        }\r\n      }\r\n\r\n      // gRPC operations\r\n      if (connection.type === 'grpc' && active.handler) {\r\n        const h = active.handler;\r\n        switch (operation) {\r\n          case 'unary':\r\n            return res.json(await h.unary(params.method, params.request || {}));\r\n          default:\r\n            return res.status(400).json({ success: false, error: `Unknown gRPC operation: ${operation}` });\r\n        }\r\n      }\r\n\r\n      // SSH operations\r\n      if (connection.type === 'ssh' && active.handler) {\r\n        const h = active.handler;\r\n        switch (operation) {\r\n          case 'exec': {\r\n            const { command, cwd } = params;\r\n            const result = await h.exec(command, cwd);\r\n            return res.json(result);\r\n          }\r\n          case 'shellOpen': {\r\n            const result = await h.shellOpen({ cols: params.cols, rows: params.rows });\r\n            return res.json(result);\r\n          }\r\n          case 'shellInput': {\r\n            const result = await h.shellInput({ sessionId: params.sessionId, data: params.data });\r\n            return res.json(result);\r\n          }\r\n          case 'shellResize': {\r\n            const result = await h.shellResize({ sessionId: params.sessionId, cols: params.cols, rows: params.rows });\r\n            return res.json(result);\r\n          }\r\n          case 'shellClose': {\r\n            const result = await h.shellClose({ sessionId: params.sessionId });\r\n            return res.json(result);\r\n          }\r\n          case 'sftpList': {\r\n            const result = await h.sftpList({ path: params.path });\r\n            return res.json(result);\r\n          }\r\n          case 'sftpGet': {\r\n            const result = await h.sftpGet({ path: params.path });\r\n            return res.json(result);\r\n          }\r\n          case 'sftpPut': {\r\n            const result = await h.sftpPut({ path: params.path, base64: params.base64 });\r\n            return res.json(result);\r\n          }\r\n          default:\r\n            return res.status(400).json({ success: false, error: `Unknown SSH operation: ${operation}` });\r\n        }\r\n      }\r\n\r\n      // WebSocket operations\r\n      if (connection.type === 'websocket' && active.handler) {\r\n        const h = active.handler;\r\n        switch (operation) {\r\n          case 'send': {\r\n            const { message } = params;\r\n            const result = await h.send(message);\r\n            return res.json(result);\r\n          }\r\n          default:\r\n            return res.status(400).json({ success: false, error: `Unknown WS operation: ${operation}` });\r\n        }\r\n      }\r\n\r\n      // SQL operations\r\n      if (connection.type === 'sql' && active.handler) {\r\n        const h = active.handler;\r\n        switch (operation) {\r\n          case 'query': {\r\n            const { sql, params = [] } = params;\r\n            const result = await h.query(sql, params);\r\n            return res.json(result);\r\n          }\r\n          default:\r\n            return res.status(400).json({ success: false, error: `Unknown SQL operation: ${operation}` });\r\n        }\r\n      }\r\n\r\n\r\n      // Kubernetes operations\r\n      if (connection.type === 'k8s' && active.handler) {\r\n        const h = active.handler;\r\n        switch (operation) {\r\n          case 'contexts':\r\n            return res.json(h.listContexts());\r\n          case 'useContext':\r\n            return res.json(h.useContext(params.name));\r\n          case 'namespaces': {\r\n            const result = await h.listNamespaces();\r\n            return res.json(result);\r\n          }\r\n          case 'pods': {\r\n            const result = await h.listPods(params.namespace);\r\n            return res.json(result);\r\n          }\r\n          case 'logsStart': {\r\n            const result = await h.logsStart({ namespace: params.namespace, pod: params.pod, container: params.container, tailLines: params.tailLines });\r\n            return res.json(result);\r\n          }\r\n          case 'logsStop': {\r\n            const result = await h.logsStop({ id: params.id });\r\n            return res.json(result);\r\n          }\r\n          case 'execOpen': {\r\n            const result = await h.execOpen({ namespace: params.namespace, pod: params.pod, container: params.container, command: params.command, tty: params.tty });\r\n            return res.json(result);\r\n          }\r\n          case 'execInput': {\r\n            const result = await h.execInput({ id: params.id, data: params.data });\r\n            return res.json(result);\r\n          }\r\n          case 'execClose': {\r\n            const result = await h.execClose({ id: params.id });\r\n            return res.json(result);\r\n          }\r\n          default:\r\n            return res.status(400).json({ success: false, error: `Unknown K8s operation: ${operation}` });\r\n        }\r\n      }\r\n\r\n      return res.status(400).json({ success: false, error: `Operation not supported for type ${connection.type}` });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  });\r\n\r\n  // OpenAPI file upload (multipart/form-data, field: openApiFile)\r\n  apiRouter.post('/upload-openapi', upload.single('openApiFile'), async (req, res) => {\r\n    try {\r\n      if (!req.file) return res.status(400).json({ success: false, error: 'No file uploaded' });\r\n      const filename = req.file.originalname;\r\n      await EnhancedRestHandler.handleFileUpload(req.file.buffer, filename);\r\n      res.json({ success: true, filename });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  });\r\n\r\n  apiRouter.post('/connections/import', async (req, res) => {\r\n    try {\r\n      const payload = req.body;\r\n      const incoming = Array.isArray(payload) ? payload : payload.connections;\r\n\r\n      if (!Array.isArray(incoming)) {\r\n        return res.status(400).json({ success: false, error: 'UngÃ¼ltiges Verbindungs-Format' });\r\n      }\r\n\r\n      const importedConnections = incoming.map(item => ({ ...normalizeConnection(item), status: 'disconnected' }));\r\n\r\n      connections.splice(0, connections.length, ...importedConnections);\r\n      activeConnections.clear();\r\n\r\n      await persistConnections(connections, db);\r\n\r\n      broadcast({\r\n        type: 'log',\r\n        data: { message: `Importierte ${importedConnections.length} Connections`, type: 'success' }\r\n      });\r\n\r\n      res.json({ success: true, connections: importedConnections, count: importedConnections.length });\r\n    } catch (error) {\r\n      res.status(500).json({ success: false, error: error.message });\r\n    }\r\n  });\r\n\r\n  // PKCE helpers\r\n  const pkceStore = new Map(); // state -> { verifier, provider, exp }\r\n  const pkceExpireMs = 10 * 60 * 1000;\r\n  function b64url(buf) { return buf.toString('base64').replace(/\\+/g,'-').replace(/\\//g,'_').replace(/=+$/,''); }\r\n  function makeVerifier() { return b64url(crypto.randomBytes(32)); }\r\n  function makeChallenge(verifier) { return b64url(crypto.createHash('sha256').update(verifier).digest()); }\r\n\r\n  // Google/GitHub OAuth (external providers)\r\n  const GOOGLE = {\r\n    auth: 'https://accounts.google.com/o/oauth2/v2/auth',\r\n    token: 'https://oauth2.googleapis.com/token',\r\n    userinfo: 'https://www.googleapis.com/oauth2/v3/userinfo',\r\n    client_id: process.env.GOOGLE_CLIENT_ID || '',\r\n    client_secret: process.env.GOOGLE_CLIENT_SECRET || '',\r\n    scope: 'openid email profile'\r\n  };\r\n  const GITHUB = {\r\n    auth: 'https://github.com/login/oauth/authorize',\r\n    token: 'https://github.com/login/oauth/access_token',\r\n    userinfo: 'https://api.github.com/user',\r\n    emails: 'https://api.github.com/user/emails',\r\n    client_id: process.env.GITHUB_CLIENT_ID || '',\r\n    client_secret: process.env.GITHUB_CLIENT_SECRET || '',\r\n    scope: 'read:user user:email'\r\n  };\r\n  function providerByName(name){ return name==='google'?GOOGLE: name==='github'?GITHUB: null; }\r\n\r\n  // Branded local consent before going out to Google/GitHub\r\n  app.get('/unicon/api/oauth/:provider/start', async (req,res) => {\r\n    const provider = providerByName(req.params.provider);\r\n    if (!provider || !provider.client_id) return res.status(400).send('provider_not_configured');\r\n    const state = b64url(crypto.randomBytes(16));\r\n    const verifier = makeVerifier();\r\n    const challenge = makeChallenge(verifier);\r\n    const redirectUri = `${req.protocol}://${req.get('host')}/unicon/api/oauth/${req.params.provider}/callback`;\r\n    pkceStore.set(state, { verifier, provider: req.params.provider, exp: Date.now()+pkceExpireMs, challenge, redirectUri });\r\n    const html = `<!doctype html><html><head><meta charset='utf-8'><title>Continue with ${req.params.provider}</title>\r\n      <style>body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f8fafc;color:#0f172a;margin:0}\r\n      .wrap{max-width:560px;margin:10vh auto;background:#fff;border:1px solid #e2e8f0;border-radius:8px;box-shadow:0 6px 20px rgba(0,0,0,.06)}\r\n      .hd{padding:20px 24px;border-bottom:1px solid #e2e8f0;display:flex;gap:8px;align-items:center}\r\n      .bd{padding:24px}\r\n      .btn{display:inline-block;padding:10px 16px;border-radius:6px;text-decoration:none}\r\n      .pri{background:#004b8d;color:#fff}\r\n      .sec{background:#e2e8f0;color:#0f172a;margin-left:8px}\r\n      .muted{color:#475569;font-size:14px}\r\n      </style></head><body>\r\n      <div class='wrap'>\r\n        <div class='hd'><strong>Unicon</strong><span class='muted'>Sign in with ${req.params.provider}</span></div>\r\n        <div class='bd'>\r\n          <p class='muted'>You will be redirected to ${req.params.provider} to continue.</p>\r\n          <div style='margin-top:16px'>\r\n            <a class='btn pri' href='/unicon/api/oauth/${req.params.provider}/continue?state=${encodeURIComponent(state)}'>Continue</a>\r\n            <a class='btn sec' href='/unicon/'>Cancel</a>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      </body></html>`;\r\n    res.setHeader('Content-Type','text/html');\r\n    return res.send(html);\r\n  });\r\n\r\n  app.get('/unicon/api/oauth/:provider/continue', (req,res) => {\r\n    const entry = pkceStore.get(req.query.state);\r\n    const provider = providerByName(req.params.provider);\r\n    if (!entry || !provider) return res.status(400).send('invalid_state');\r\n    const params = new URLSearchParams({\r\n      client_id: provider.client_id,\r\n      response_type: 'code',\r\n      redirect_uri: entry.redirectUri,\r\n      scope: provider.scope,\r\n      code_challenge: entry.challenge,\r\n      code_challenge_method: 'S256',\r\n      access_type: 'offline',\r\n      state: req.query.state\r\n    });\r\n    return res.redirect(`${provider.auth}?${params.toString()}`);\r\n  });\r\n\r\n  app.get('/unicon/api/oauth/:provider/callback', async (req,res) => {\r\n    try {\r\n      const provider = providerByName(req.params.provider);\r\n      if (!provider) return res.status(400).send('unknown_provider');\r\n      const { code, state } = req.query || {};\r\n      const entry = pkceStore.get(state); pkceStore.delete(state);\r\n      if (!entry || entry.exp < Date.now()) return res.status(400).send('invalid_state');\r\n      if (entry.provider !== req.params.provider) return res.status(400).send('state_provider_mismatch');\r\n      const redirectUri = `${req.protocol}://${req.get('host')}/unicon/api/oauth/${req.params.provider}/callback`;\r\n      // Exchange code\r\n      const axios = require('axios');\r\n      let tokenResp;\r\n      if (provider === GITHUB) {\r\n        tokenResp = await axios.post(provider.token, new URLSearchParams({\r\n          client_id: provider.client_id,\r\n          client_secret: provider.client_secret,\r\n          code: code,\r\n          redirect_uri: redirectUri,\r\n          grant_type: 'authorization_code'\r\n        }), { headers: { Accept: 'application/json' } });\r\n      } else {\r\n        tokenResp = await axios.post(provider.token, new URLSearchParams({\r\n          client_id: provider.client_id,\r\n          client_secret: provider.client_secret,\r\n          code: code,\r\n          redirect_uri: redirectUri,\r\n          grant_type: 'authorization_code',\r\n          code_verifier: entry.verifier\r\n        }), { headers: { 'Content-Type': 'application/x-www-form-urlencoded' } });\r\n      }\r\n      const accessToken = tokenResp.data.access_token;\r\n      if (!accessToken) return res.status(400).send('token_exchange_failed');\r\n      // Fetch user info\r\n      let email = null; let avatar = null; let providerName = (provider===GOOGLE?'google':'github');\r\n      if (provider === GOOGLE) {\r\n        const u = await axios.get(provider.userinfo, { headers: { Authorization: `Bearer ${accessToken}` } });\r\n        email = u.data?.email; avatar = u.data?.picture || null;\r\n      } else if (provider === GITHUB) {\r\n        const u = await axios.get(provider.userinfo, { headers: { Authorization: `Bearer ${accessToken}`, 'User-Agent': 'unicon' } });\r\n        email = u.data?.email; avatar = u.data?.avatar_url || null;\r\n        if (!email) {\r\n          const e = await axios.get(provider.emails, { headers: { Authorization: `Bearer ${accessToken}`, 'User-Agent': 'unicon' } });\r\n          email = (e.data || []).find(x => x.primary)?.email || (e.data[0]?.email);\r\n        }\r\n      }\r\n      if (!email) return res.status(400).send('email_not_found');\r\n      // Provision user and emit local code for client\r\n      if (DB) {\r\n        const dbi = (await buildState()).db;\r\n        let u = await dbi.getUserByEmail(email);\r\n        if (!u) {\r\n          const { v4: uuidv4 } = require('uuid');\r\n          await dbi.createUser({ id: uuidv4(), email, password_hash: 'oauth', salt: 'oauth', createdAt: new Date().toISOString() });\r\n          u = await dbi.getUserByEmail(email);\r\n          await dbi.assignRoleToUser(u.id, 'developer');\r\n        }\r\n        if (avatar) await dbi.setUserPref(u.id || (await dbi.getUserByEmail(email)).id, 'avatar', avatar);\r\n        await dbi.setUserPref(u.id || (await dbi.getUserByEmail(email)).id, 'provider', providerName);\r\n      }\r\n      const localCode = `${Date.now()}-${crypto.randomBytes(6).toString('hex')}`;\r\n      oauthCodes.set(localCode, { userEmail: email, exp: Date.now() + 5 * 60 * 1000 });\r\n      const clientRedirect = `${req.protocol}://${req.get('host')}/unicon/auth/callback`;\r\n      const sep = clientRedirect.includes('?') ? '&' : '?';\r\n      return res.redirect(`${clientRedirect}${sep}code=${encodeURIComponent(localCode)}&provider=${req.params.provider}`);\r\n    } catch (e) {\r\n      return res.status(500).send('oauth_error');\r\n    }\r\n  });\r\n\r\n  // OAuth2 demo endpoints (local only) with minimal consent + PKCE-like state\r\n  const oauthCodes = new Map(); // code -> { userEmail, exp }\r\n  app.get('/unicon/api/oauth/authorize', (req, res) => {\r\n    const { client_id, redirect_uri, state } = req.query || {};\r\n    const okClient = client_id === 'demo';\r\n    const okRedirect = typeof redirect_uri === 'string' && /\\/unicon\\/auth\\/callback$/.test(redirect_uri);\r\n    if (!okClient || !okRedirect) return res.status(400).send('invalid_client or invalid_redirect');\r\n    // Minimal consent HTML\r\n    const html = `<!doctype html><html><head><meta charset=\"utf-8\"><title>Authorize â€“ Demo</title>\r\n      <style>body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;padding:0;background:#f8fafc;color:#0f172a}\r\n      .wrap{max-width:540px;margin:10vh auto;background:#fff;border:1px solid #e2e8f0;border-radius:8px;box-shadow:0 6px 20px rgba(0,0,0,.06)}\r\n      .hd{padding:20px 24px;border-bottom:1px solid #e2e8f0;display:flex;align-items:center;gap:8px}\r\n      .bd{padding:24px}\r\n      .btn{display:inline-block;padding:10px 16px;border-radius:6px;text-decoration:none}\r\n      .pri{background:#004b8d;color:#fff}\r\n      .sec{background:#e2e8f0;color:#0f172a;margin-left:8px}\r\n      .muted{color:#475569;font-size:14px}\r\n      </style></head><body>\r\n      <div class=\"wrap\">\r\n        <div class=\"hd\"><strong>Unicon Demo OAuth</strong></div>\r\n        <div class=\"bd\">\r\n          <p class=\"muted\">The application <strong>Unicon</strong> is requesting access to your demo account <strong>demo@unicon.local</strong>.</p>\r\n          <ul class=\"muted\"><li>Read profile (email)</li><li>Basic access</li></ul>\r\n          <div style=\"margin-top:16px\">\r\n            <a class=\"btn pri\" href=\"/unicon/api/oauth/authorize/decision?client_id=${encodeURIComponent(client_id)}&redirect_uri=${encodeURIComponent(redirect_uri)}&state=${encodeURIComponent(state||'')}&consent=allow\">Allow</a>\r\n            <a class=\"btn sec\" href=\"/unicon/api/oauth/authorize/decision?client_id=${encodeURIComponent(client_id)}&redirect_uri=${encodeURIComponent(redirect_uri)}&state=${encodeURIComponent(state||'')}&consent=deny\">Cancel</a>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      </body></html>`;\r\n    res.setHeader('Content-Type','text/html');\r\n    return res.send(html);\r\n  });\r\n  app.get('/unicon/api/oauth/authorize/decision', (req,res)=>{\r\n    const { client_id, redirect_uri, state, consent } = req.query||{};\r\n    const okClient = client_id === 'demo';\r\n    const okRedirect = typeof redirect_uri === 'string' && /\\/unicon\\/auth\\/callback$/.test(redirect_uri);\r\n    if (!okClient || !okRedirect) return res.status(400).send('invalid_client or invalid_redirect');\r\n    const sep = redirect_uri.includes('?') ? '&' : '?';\r\n    if (consent !== 'allow') return res.redirect(`${redirect_uri}${sep}error=access_denied${state?`&state=${encodeURIComponent(state)}`:''}`);\r\n    const code = `${Date.now()}-${Math.random().toString(36).slice(2)}`;\r\n    oauthCodes.set(code, { userEmail: 'demo@unicon.local', exp: Date.now() + 5 * 60 * 1000 });\r\n    return res.redirect(`${redirect_uri}${sep}code=${encodeURIComponent(code)}${state ? `&state=${encodeURIComponent(state)}` : ''}`);\r\n  });\r\n  app.post('/unicon/api/oauth/token', express.json(), async (req, res) => {\r\n    try {\r\n      const { code, client_id } = req.body || {};\r\n      if (client_id !== 'demo' || !oauthCodes.has(code)) return res.status(400).json({ error: 'invalid_grant' });\r\n      const entry = oauthCodes.get(code); oauthCodes.delete(code);\r\n      if (!entry || entry.exp < Date.now()) return res.status(400).json({ error: 'expired_code' });\r\n      // ensure user exists\r\n      if (DB) {\r\n        const db = (await buildState()).db; // reuse init to have db\r\n        let u = await db.getUserByEmail(entry.userEmail);\r\n        if (!u) {\r\n          const { v4: uuidv4 } = require('uuid');\r\n          await db.createUser({ id: uuidv4(), email: entry.userEmail, password_hash: 'oauth', salt: 'oauth', createdAt: new Date().toISOString() });\r\n          u = await db.getUserByEmail(entry.userEmail);\r\n          await db.assignRoleToUser(u.id, 'developer');\r\n        }\r\n      }\r\n      const { issueJWT } = require('./auth/middleware');\r\n      const token = issueJWT({ id: entry.userEmail, email: entry.userEmail, roles: ['developer'] });\r\n      return res.json({ access_token: token, token_type: 'Bearer', expires_in: 8 * 60 * 60 });\r\n    } catch (e) { return res.status(500).json({ error: 'server_error' }); }\r\n  });\r\n\r\n  app.use('/unicon/api', apiRouter);\r\n\r\n  app.use('/unicon', express.static(path.join(__dirname, 'public')));\r\n\r\n  app.get('/unicon/*', (req, res) => {\r\n    try {\r\n      const file = path.join(__dirname, 'public', 'index.html');\r\n      let html = fs.readFileSync(file, 'utf8');\r\n      // inject a tiny inline script with a nonce (for CSP verification in prod)\r\n      const nonce = crypto.randomBytes(16).toString('base64');\r\n      const current = (res.getHeader('Content-Security-Policy')||'').toString();\r\n      const updated = current.replace(\"script-src 'self'\", `script-src 'self' 'nonce-${nonce}' 'strict-dynamic'`)\r\n                             .replace(\"style-src 'self' 'unsafe-inline'\", \"style-src 'self'\");\r\n      res.setHeader('Content-Security-Policy', updated);\r\n      html = html.replace('</head>', `<script nonce=\"${nonce}\">window.__csp=1</script></head>`);\r\n      res.setHeader('Content-Type','text/html');\r\n      res.send(html);\r\n    } catch (e) {\r\n      res.sendFile(path.join(__dirname, 'public', 'index.html'));\r\n    }\r\n  });\r\n\r\n  app.get('/', (req, res) => {\r\n    res.json({\r\n      message: 'Universal Protocol Test Client Backend',\r\n      version: '1.0.0',\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  });\r\n\r\n  return app;\r\n};\r\n\r\nconst createWebSocketServer = (connectedClients, customPort = WS_PORT) => {\r\n  const wsServer = new WebSocket.Server({\r\n    port: customPort,\r\n    host: '0.0.0.0'\r\n  });\r\n\r\n  wsServer.on('connection', ws => {\r\n    connectedClients.add(ws);\r\n\r\n    ws.on('close', () => {\r\n      connectedClients.delete(ws);\r\n    });\r\n\r\n    ws.on('error', error => {\r\n      console.error('WebSocket error:', error);\r\n      connectedClients.delete(ws);\r\n    });\r\n\r\n    ws.send(JSON.stringify({\r\n      type: 'connection_status',\r\n      data: { status: 'connected', timestamp: new Date().toISOString() }\r\n    }));\r\n  });\r\n\r\n  return wsServer;\r\n};\r\n\r\nlet __RUNNING = { server: null, wsServer: null };\r\n\r\nconst startServers = async (state) => {\r\n  // Ensure only one instance is running (helps Jest suites reusing the same ports)\r\n  if (__RUNNING.server) {\r\n    try { __RUNNING.wsServer && __RUNNING.wsServer.close(); } catch {}\r\n    try { await new Promise(res => __RUNNING.server.close(() => res(null))); } catch {}\r\n    __RUNNING = { server: null, wsServer: null };\r\n  }\r\n  let resolvedState = state;\r\n  if (!resolvedState) {\r\n    resolvedState = await buildState();\r\n  } else if (typeof resolvedState.then === 'function') {\r\n    resolvedState = await resolvedState;\r\n  }\r\n  const app = createApp(resolvedState);\r\n  const httpPort = Number(process.env.PORT) || PORT;\r\n  const wsPort = Number(process.env.WS_PORT) || WS_PORT;\r\n  const wsServer = createWebSocketServer(resolvedState.connectedClients, wsPort);\r\n  const server = app.listen(httpPort, '0.0.0.0', () => {\r\n    console.log(`ðŸš€ HTTP Server running on port ${httpPort}`);\r\n    console.log(`ðŸ“¡ WebSocket Server running on port ${wsPort}`);\r\n    console.log(`ðŸŒ API available at http://localhost:${httpPort}/unicon/api`);\r\n  });\r\n\r\n  const shutdown = () => {\r\n    wsServer.close();\r\n    server.close(() => process.exit(0));\r\n  };\r\n\r\n  process.on('SIGTERM', shutdown);\r\n  process.on('SIGINT', shutdown);\r\n\r\n  __RUNNING = { server, wsServer };\r\n  return { app, server, wsServer, state };\r\n};\r\n\r\nif (require.main === module) {\r\n  startServers();\r\n}\r\n\r\nmodule.exports = {\r\n  createApp,\r\n  createWebSocketServer,\r\n  startServers,\r\n  buildState,\r\n  parseAllowedOrigins\r\n};\r\n"],"mappings":"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","ignoreList":[]}