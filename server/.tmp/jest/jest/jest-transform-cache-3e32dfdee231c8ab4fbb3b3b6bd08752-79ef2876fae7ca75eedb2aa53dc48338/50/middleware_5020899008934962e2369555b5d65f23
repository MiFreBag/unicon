bf0ffb9ecd7d13b184d9b410b12563ec
const jwt = require('jsonwebtoken');
const JWT_SECRET = process.env.JWT_SECRET || 'dev-secret-not-for-prod';
function verifyJWT(req, res, next) {
  const auth = req.headers['authorization'] || '';
  const token = auth.startsWith('Bearer ') ? auth.slice(7) : null;
  if (!token) return res.status(401).json({
    success: false,
    error: 'missing token'
  });
  try {
    const payload = jwt.verify(token, JWT_SECRET, {
      algorithms: ['HS256']
    });
    req.user = payload; // { sub, email, roles }
    next();
  } catch (e) {
    return res.status(401).json({
      success: false,
      error: 'invalid token'
    });
  }
}
function requireRoles(...roles) {
  return (req, res, next) => {
    const userRoles = Array.isArray(req.user?.roles) ? req.user.roles : [];
    const ok = roles.length === 0 || roles.some(r => userRoles.includes(r));
    if (!ok) return res.status(403).json({
      success: false,
      error: 'forbidden'
    });
    next();
  };
}
function issueJWT({
  id,
  email,
  roles
}) {
  const payload = {
    sub: id,
    email,
    roles
  };
  const token = jwt.sign(payload, JWT_SECRET, {
    algorithm: 'HS256',
    expiresIn: '8h'
  });
  return token;
}
module.exports = {
  verifyJWT,
  requireRoles,
  issueJWT
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJqd3QiLCJyZXF1aXJlIiwiSldUX1NFQ1JFVCIsInByb2Nlc3MiLCJlbnYiLCJ2ZXJpZnlKV1QiLCJyZXEiLCJyZXMiLCJuZXh0IiwiYXV0aCIsImhlYWRlcnMiLCJ0b2tlbiIsInN0YXJ0c1dpdGgiLCJzbGljZSIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwiZXJyb3IiLCJwYXlsb2FkIiwidmVyaWZ5IiwiYWxnb3JpdGhtcyIsInVzZXIiLCJlIiwicmVxdWlyZVJvbGVzIiwicm9sZXMiLCJ1c2VyUm9sZXMiLCJBcnJheSIsImlzQXJyYXkiLCJvayIsImxlbmd0aCIsInNvbWUiLCJyIiwiaW5jbHVkZXMiLCJpc3N1ZUpXVCIsImlkIiwiZW1haWwiLCJzdWIiLCJzaWduIiwiYWxnb3JpdGhtIiwiZXhwaXJlc0luIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIm1pZGRsZXdhcmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XHJcblxyXG5jb25zdCBKV1RfU0VDUkVUID0gcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCB8fCAnZGV2LXNlY3JldC1ub3QtZm9yLXByb2QnO1xyXG5cclxuZnVuY3Rpb24gdmVyaWZ5SldUKHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgY29uc3QgYXV0aCA9IHJlcS5oZWFkZXJzWydhdXRob3JpemF0aW9uJ10gfHwgJyc7XHJcbiAgY29uc3QgdG9rZW4gPSBhdXRoLnN0YXJ0c1dpdGgoJ0JlYXJlciAnKSA/IGF1dGguc2xpY2UoNykgOiBudWxsO1xyXG4gIGlmICghdG9rZW4pIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ21pc3NpbmcgdG9rZW4nIH0pO1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBwYXlsb2FkID0gand0LnZlcmlmeSh0b2tlbiwgSldUX1NFQ1JFVCwgeyBhbGdvcml0aG1zOiBbJ0hTMjU2J10gfSk7XHJcbiAgICByZXEudXNlciA9IHBheWxvYWQ7IC8vIHsgc3ViLCBlbWFpbCwgcm9sZXMgfVxyXG4gICAgbmV4dCgpO1xyXG4gIH0gY2F0Y2ggKGUpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ2ludmFsaWQgdG9rZW4nIH0pO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcmVxdWlyZVJvbGVzKC4uLnJvbGVzKSB7XHJcbiAgcmV0dXJuIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgY29uc3QgdXNlclJvbGVzID0gQXJyYXkuaXNBcnJheShyZXEudXNlcj8ucm9sZXMpID8gcmVxLnVzZXIucm9sZXMgOiBbXTtcclxuICAgIGNvbnN0IG9rID0gcm9sZXMubGVuZ3RoID09PSAwIHx8IHJvbGVzLnNvbWUociA9PiB1c2VyUm9sZXMuaW5jbHVkZXMocikpO1xyXG4gICAgaWYgKCFvaykgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnZm9yYmlkZGVuJyB9KTtcclxuICAgIG5leHQoKTtcclxuICB9O1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc3N1ZUpXVCh7IGlkLCBlbWFpbCwgcm9sZXMgfSkge1xyXG4gIGNvbnN0IHBheWxvYWQgPSB7IHN1YjogaWQsIGVtYWlsLCByb2xlcyB9O1xyXG4gIGNvbnN0IHRva2VuID0gand0LnNpZ24ocGF5bG9hZCwgSldUX1NFQ1JFVCwgeyBhbGdvcml0aG06ICdIUzI1NicsIGV4cGlyZXNJbjogJzhoJyB9KTtcclxuICByZXR1cm4gdG9rZW47XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0geyB2ZXJpZnlKV1QsIHJlcXVpcmVSb2xlcywgaXNzdWVKV1QgfTsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLEdBQUcsR0FBR0MsT0FBTyxDQUFDLGNBQWMsQ0FBQztBQUVuQyxNQUFNQyxVQUFVLEdBQUdDLE9BQU8sQ0FBQ0MsR0FBRyxD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