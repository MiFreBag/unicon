{"version":3,"names":["jwt","require","JWT_SECRET","process","env","verifyJWT","req","res","next","auth","headers","token","startsWith","slice","status","json","success","error","payload","verify","algorithms","user","e","requireRoles","roles","userRoles","Array","isArray","ok","length","some","r","includes","issueJWT","id","email","sub","sign","algorithm","expiresIn","module","exports"],"sources":["middleware.js"],"sourcesContent":["const jwt = require('jsonwebtoken');\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'dev-secret-not-for-prod';\r\n\r\nfunction verifyJWT(req, res, next) {\r\n  const auth = req.headers['authorization'] || '';\r\n  const token = auth.startsWith('Bearer ') ? auth.slice(7) : null;\r\n  if (!token) return res.status(401).json({ success: false, error: 'missing token' });\r\n  try {\r\n    const payload = jwt.verify(token, JWT_SECRET, { algorithms: ['HS256'] });\r\n    req.user = payload; // { sub, email, roles }\r\n    next();\r\n  } catch (e) {\r\n    return res.status(401).json({ success: false, error: 'invalid token' });\r\n  }\r\n}\r\n\r\nfunction requireRoles(...roles) {\r\n  return (req, res, next) => {\r\n    const userRoles = Array.isArray(req.user?.roles) ? req.user.roles : [];\r\n    const ok = roles.length === 0 || roles.some(r => userRoles.includes(r));\r\n    if (!ok) return res.status(403).json({ success: false, error: 'forbidden' });\r\n    next();\r\n  };\r\n}\r\n\r\nfunction issueJWT({ id, email, roles }) {\r\n  const payload = { sub: id, email, roles };\r\n  const token = jwt.sign(payload, JWT_SECRET, { algorithm: 'HS256', expiresIn: '8h' });\r\n  return token;\r\n}\r\n\r\nmodule.exports = { verifyJWT, requireRoles, issueJWT };"],"mappings":"AAAA,MAAMA,GAAG,GAAGC,OAAO,CAAC,cAAc,CAAC;AAEnC,MAAMC,UAAU,GAAGC,OAAO,CAACC,GAAG,CAACF,UAAU,IAAI,yBAAyB;AAEtE,SAASG,SAASA,CAACC,GAAG,EAAEC,GAAG,EAAEC,IAAI,EAAE;EACjC,MAAMC,IAAI,GAAGH,GAAG,CAACI,OAAO,CAAC,eAAe,CAAC,IAAI,EAAE;EAC/C,MAAMC,KAAK,GAAGF,IAAI,CAACG,UAAU,CAAC,SAAS,CAAC,GAAGH,IAAI,CAACI,KAAK,CAAC,CAAC,CAAC,GAAG,IAAI;EAC/D,IAAI,CAACF,KAAK,EAAE,OAAOJ,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;IAAEC,OAAO,EAAE,KAAK;IAAEC,KAAK,EAAE;EAAgB,CAAC,CAAC;EACnF,IAAI;IACF,MAAMC,OAAO,GAAGlB,GAAG,CAACmB,MAAM,CAACR,KAAK,EAAET,UAAU,EAAE;MAAEkB,UAAU,EAAE,CAAC,OAAO;IAAE,CAAC,CAAC;IACxEd,GAAG,CAACe,IAAI,GAAGH,OAAO,CAAC,CAAC;IACpBV,IAAI,CAAC,CAAC;EACR,CAAC,CAAC,OAAOc,CAAC,EAAE;IACV,OAAOf,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAAEC,OAAO,EAAE,KAAK;MAAEC,KAAK,EAAE;IAAgB,CAAC,CAAC;EACzE;AACF;AAEA,SAASM,YAAYA,CAAC,GAAGC,KAAK,EAAE;EAC9B,OAAO,CAAClB,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;IACzB,MAAMiB,SAAS,GAAGC,KAAK,CAACC,OAAO,CAACrB,GAAG,CAACe,IAAI,EAAEG,KAAK,CAAC,GAAGlB,GAAG,CAACe,IAAI,CAACG,KAAK,GAAG,EAAE;IACtE,MAAMI,EAAE,GAAGJ,KAAK,CAACK,MAAM,KAAK,CAAC,IAAIL,KAAK,CAACM,IAAI,CAACC,CAAC,IAAIN,SAAS,CAACO,QAAQ,CAACD,CAAC,CAAC,CAAC;IACvE,IAAI,CAACH,EAAE,EAAE,OAAOrB,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAAEC,OAAO,EAAE,KAAK;MAAEC,KAAK,EAAE;IAAY,CAAC,CAAC;IAC5ET,IAAI,CAAC,CAAC;EACR,CAAC;AACH;AAEA,SAASyB,QAAQA,CAAC;EAAEC,EAAE;EAAEC,KAAK;EAAEX;AAAM,CAAC,EAAE;EACtC,MAAMN,OAAO,GAAG;IAAEkB,GAAG,EAAEF,EAAE;IAAEC,KAAK;IAAEX;EAAM,CAAC;EACzC,MAAMb,KAAK,GAAGX,GAAG,CAACqC,IAAI,CAACnB,OAAO,EAAEhB,UAAU,EAAE;IAAEoC,SAAS,EAAE,OAAO;IAAEC,SAAS,EAAE;EAAK,CAAC,CAAC;EACpF,OAAO5B,KAAK;AACd;AAEA6B,MAAM,CAACC,OAAO,GAAG;EAAEpC,SAAS;EAAEkB,YAAY;EAAEU;AAAS,CAAC","ignoreList":[]}