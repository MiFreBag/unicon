{"version":3,"names":["request","require","startServers","buildState","srv","baseUrl","beforeAll","process","env","PORT","WS_PORT","afterAll","done","server","close","test","createRes","post","send","name","type","config","driver","filename","set","expect","status","toBe","connectionId","body","connection","id","connectRes","opRes","operation","params","sql","Array","isArray","data","rows","length"],"sources":["sql_sqlite.test.js"],"sourcesContent":["const request = require('supertest');\r\nconst { startServers, buildState } = require('..');\r\n\r\nlet srv;\r\nlet baseUrl;\r\n\r\nbeforeAll(() => {\r\n  process.env.PORT = process.env.PORT || '3102';\r\n  process.env.WS_PORT = process.env.WS_PORT || '8181';\r\n  srv = startServers(buildState());\r\n  baseUrl = `http://127.0.0.1:${process.env.PORT}`;\r\n});\r\n\r\nafterAll((done) => {\r\n  try { srv.server.close(() => done()); } catch { done(); }\r\n});\r\n\r\ntest('sqlite :memory: create/insert/select', async () => {\r\n  // Create SQL connection\r\n  const createRes = await request(baseUrl)\r\n    .post('/unicon/api/connections')\r\n    .send({ name: 'mem-sqlite', type: 'sql', config: { driver: 'sqlite', filename: ':memory:' } })\r\n    .set('Content-Type', 'application/json');\r\n  expect(createRes.status).toBe(200);\r\n  const connectionId = createRes.body.connection.id;\r\n\r\n  // Connect\r\n  const connectRes = await request(baseUrl)\r\n    .post('/unicon/api/connect')\r\n    .send({ connectionId })\r\n    .set('Content-Type', 'application/json');\r\n  expect(connectRes.status).toBe(200);\r\n\r\n  // Create table\r\n  let opRes = await request(baseUrl)\r\n    .post('/unicon/api/operation')\r\n    .send({ connectionId, operation: 'query', params: { sql: 'CREATE TABLE t (id INTEGER PRIMARY KEY, name TEXT)' } })\r\n    .set('Content-Type', 'application/json');\r\n  expect(opRes.status).toBe(200);\r\n\r\n  // Insert\r\n  opRes = await request(baseUrl)\r\n    .post('/unicon/api/operation')\r\n    .send({ connectionId, operation: 'query', params: { sql: 'INSERT INTO t (name) VALUES (?)', params: ['alice'] } })\r\n    .set('Content-Type', 'application/json');\r\n  expect(opRes.status).toBe(200);\r\n\r\n  // Select\r\n  opRes = await request(baseUrl)\r\n    .post('/unicon/api/operation')\r\n    .send({ connectionId, operation: 'query', params: { sql: 'SELECT * FROM t' } })\r\n    .set('Content-Type', 'application/json');\r\n  expect(opRes.status).toBe(200);\r\n  expect(Array.isArray(opRes.body.data.rows) || Array.isArray(opRes.body.rows)).toBe(true);\r\n  const rows = opRes.body.data?.rows || opRes.body.rows;\r\n  expect(rows.length).toBe(1);\r\n  expect(rows[0].name).toBe('alice');\r\n});\r\n"],"mappings":"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","ignoreList":[]}