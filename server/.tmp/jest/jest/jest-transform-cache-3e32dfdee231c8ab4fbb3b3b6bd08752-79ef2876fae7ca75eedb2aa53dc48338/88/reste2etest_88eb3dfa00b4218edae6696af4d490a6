a0683e21fff7af06dfa09f86860dca92
const request = require('supertest');

// Set env before requiring the server module so constants pick them up
process.env.PORT = '3101';
process.env.WS_PORT = '8180';
const {
  startServers
} = require('../universal-server');
let started;
beforeAll(async () => {
  started = await startServers();
});
afterAll(() => {
  if (started?.server) started.server.close();
  if (started?.wsServer) started.wsServer.close();
});
test('GET /unicon/api/health returns healthy', async () => {
  const agent = request(`http://localhost:${process.env.PORT}`);
  const res = await agent.get('/unicon/api/health');
  expect(res.status).toBe(200);
  expect(res.body).toHaveProperty('success', true);
  expect(res.body).toHaveProperty('status', 'healthy');
});
test('Connections list returns array', async () => {
  const agent = request(`http://localhost:${process.env.PORT}`);
  const res = await agent.get('/unicon/api/connections');
  expect(res.status).toBe(200);
  expect(Array.isArray(res.body.connections)).toBe(true);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1ZXN0IiwicmVxdWlyZSIsInByb2Nlc3MiLCJlbnYiLCJQT1JUIiwiV1NfUE9SVCIsInN0YXJ0U2VydmVycyIsInN0YXJ0ZWQiLCJiZWZvcmVBbGwiLCJhZnRlckFsbCIsInNlcnZlciIsImNsb3NlIiwid3NTZXJ2ZXIiLCJ0ZXN0IiwiYWdlbnQiLCJyZXMiLCJnZXQiLCJleHBlY3QiLCJzdGF0dXMiLCJ0b0JlIiwiYm9keSIsInRvSGF2ZVByb3BlcnR5IiwiQXJyYXkiLCJpc0FycmF5IiwiY29ubmVjdGlvbnMiXSwic291cmNlcyI6WyJyZXN0LmUyZS50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHJlcXVlc3QgPSByZXF1aXJlKCdzdXBlcnRlc3QnKTtcclxuXHJcbi8vIFNldCBlbnYgYmVmb3JlIHJlcXVpcmluZyB0aGUgc2VydmVyIG1vZHVsZSBzbyBjb25zdGFudHMgcGljayB0aGVtIHVwXHJcbnByb2Nlc3MuZW52LlBPUlQgPSAnMzEwMSc7XHJcbnByb2Nlc3MuZW52LldTX1BPUlQgPSAnODE4MCc7XHJcblxyXG5jb25zdCB7IHN0YXJ0U2VydmVycyB9ID0gcmVxdWlyZSgnLi4vdW5pdmVyc2FsLXNlcnZlcicpO1xyXG5cclxubGV0IHN0YXJ0ZWQ7XHJcblxyXG5iZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xyXG4gIHN0YXJ0ZWQgPSBhd2FpdCBzdGFydFNlcnZlcnMoKTtcclxufSk7XHJcblxyXG5hZnRlckFsbCgoKSA9PiB7XHJcbiAgaWYgKHN0YXJ0ZWQ/LnNlcnZlcikgc3RhcnRlZC5zZXJ2ZXIuY2xvc2UoKTtcclxuICBpZiAoc3RhcnRlZD8ud3NTZXJ2ZXIpIHN0YXJ0ZWQud3NTZXJ2ZXIuY2xvc2UoKTtcclxufSk7XHJcblxyXG50ZXN0KCdHRVQgL3VuaWNvbi9hcGkvaGVhbHRoIHJldHVybnMgaGVhbHRoeScsIGFzeW5jICgpID0+IHtcclxuICBjb25zdCBhZ2VudCA9IHJlcXVlc3QoYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwcm9jZXNzLmVudi5QT1JUfWApO1xyXG4gIGNvbnN0IHJlcyA9IGF3YWl0IGFnZW50LmdldCgnL3VuaWNvbi9hcGkvaGVhbHRoJyk7XHJcbiAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmUoMjAwKTtcclxuICBleHBlY3QocmVzLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdzdWNjZXNzJywgdHJ1ZSk7XHJcbiAgZXhwZWN0KHJlcy5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnc3RhdHVzJywgJ2hlYWx0aHknKTtcclxufSk7XHJcblxyXG50ZXN0KCdDb25uZWN0aW9ucyBsaXN0IHJldHVybnMgYXJyYXknLCBhc3luYyAoKSA9PiB7XHJcbiAgY29uc3QgYWdlbnQgPSByZXF1ZXN0KGBodHRwOi8vbG9jYWxob3N0OiR7cHJvY2Vzcy5lbnYuUE9SVH1gKTtcclxuICBjb25zdCByZXMgPSBhd2FpdCBhZ2VudC5nZXQoJy91bmljb24vYXBpL2Nvbm5lY3Rpb25zJyk7XHJcbiAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmUoMjAwKTtcclxuICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXMuYm9keS5jb25uZWN0aW9ucykpLnRvQmUodHJ1ZSk7XHJcbn0pOyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsV0FBVyxDQUFDOztBQUVwQztBQUNBQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsSUFBSSxHQUFHLE1BQU07QUFDekJGLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDRSxPQUFPLEdBQUcsTUFBTTtBQUU1QixNQUFNO0VBQUVDO0FBQWEsQ0FBQyxHQUFHTCxPQUFPLENBQUMscUJBQXFCLENBQUM7QUFFdkQsSUFBSU0sT0FBTztBQUVYQyxTQUFTLENBQUMsWUFBWTtFQUNwQkQsT0FBTyxHQUFHLE1BQU1ELFlBQVksQ0FBQyxDQUFDO0FBQ2hDLENBQUMsQ0FBQztBQUVGRyxRQUFRLENBQUMsTUFBTTtFQUNiLElBQUlGLE9BQU8sRUFBRUcsTUFBTSxFQUFFSCxPQUFPLENBQUNHLE1BQU0sQ0FBQ0MsS0FBSyxDQUFDLENBQUM7RUFDM0MsSUFBSUosT0FBTyxFQUFFSyxRQUFRLEVBQUVMLE9BQU8sQ0FBQ0ssUUFBUSxDQUFDRCxLQUFLLENBQUMsQ0FBQztBQUNqRCxDQUFDLENBQUM7QUFFRkUsSUFBSSxDQUFDLHdDQUF3QyxFQUFFLFlBQVk7RUFDekQsTUFBTUMsS0FBSyxHQUFHZCxPQUFPLENBQUMsb0JBQW9CRSxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsSUFBSSxFQUFFLENBQUM7RUFDN0QsTUFBTVcsR0FBRyxHQUFHLE1BQU1ELEtBQUssQ0FBQ0UsR0FBRyxDQUFDLG9CQUFvQixDQUFDO0VBQ2pEQyxNQUFNLENBQUNGLEdBQUcsQ0FBQ0csTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxHQUFHLENBQUM7RUFDNUJGLE1BQU0sQ0FBQ0YsR0FBRyxDQUFDSyxJQUFJLENBQUMsQ0FBQ0MsY0FBYyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUM7RUFDaERKLE1BQU0sQ0FBQ0YsR0FBRyxDQUFDSyxJQUFJLENBQUMsQ0FBQ0MsY0FBYyxDQUFDLFFBQVEsRUFBRSxTQUFTLENBQUM7QUFDdEQsQ0FBQyxDQUFDO0FBRUZSLElBQUksQ0FBQyxnQ0FBZ0MsRUFBRSxZQUFZO0VBQ2pELE1BQU1DLEtBQUssR0FBR2QsT0FBTyxDQUFDLG9CQUFvQkUsT0FBTyxDQUFDQyxHQUFHLENBQUNDLElBQUksRUFBRSxDQUFDO0VBQzdELE1BQU1XLEdBQUcsR0FBRyxNQUFNRCxLQUFLLENBQUNFLEdBQUcsQ0FBQyx5QkFBeUIsQ0FBQztFQUN0REMsTUFBTSxDQUFDRixHQUFHLENBQUNHLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUMsR0FBRyxDQUFDO0VBQzVCRixNQUFNLENBQUNLLEtBQUssQ0FBQ0MsT0FBTyxDQUFDUixHQUFHLENBQUNLLElBQUksQ0FBQ0ksV0FBVyxDQUFDLENBQUMsQ0FBQ0wsSUFBSSxDQUFDLElBQUksQ0FBQztBQUN4RCxDQUFDLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=