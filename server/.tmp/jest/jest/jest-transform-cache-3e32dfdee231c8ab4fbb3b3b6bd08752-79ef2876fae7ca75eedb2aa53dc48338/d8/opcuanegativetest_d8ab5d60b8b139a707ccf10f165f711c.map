{"version":3,"names":["request","require","fs","os","path","jest","setTimeout","tmpDir","mkdtempSync","join","tmpdir","process","env","CONNECTION_DATA_DIR","PERSISTENCE","PORT","WS_PORT","startServers","started","api","beforeAll","afterAll","server","close","wsServer","test","create","post","send","name","type","config","endpointUrl","timeoutMs","expect","body","success","toBe","id","connection","con","connectionId","status","toBeGreaterThanOrEqual"],"sources":["opcua.negative.test.js"],"sourcesContent":["const request = require('supertest');\r\nconst fs = require('fs');\r\nconst os = require('os');\r\nconst path = require('path');\r\n\r\njest.setTimeout(15000);\r\n\r\nconst tmpDir = fs.mkdtempSync(path.join(os.tmpdir(), 'unicon-opcua-neg-'));\r\nprocess.env.CONNECTION_DATA_DIR = tmpDir;\r\nprocess.env.PERSISTENCE = 'file';\r\nprocess.env.PORT = '3110';\r\nprocess.env.WS_PORT = '8190';\r\n\r\nconst { startServers } = require('../universal-server');\r\n\r\nlet started; let api;\r\n\r\nbeforeAll(async () => {\r\n  started = await startServers();\r\n  api = request(`http://localhost:${process.env.PORT}`);\r\n});\r\n\r\nafterAll(() => {\r\n  if (started?.server) started.server.close();\r\n  if (started?.wsServer) started.wsServer.close();\r\n});\r\n\r\ntest('OPC UA connect fails for bad endpoint', async () => {\r\n  const create = await api.post('/unicon/api/connections').send({\r\n    name: 'opcua-bad',\r\n    type: 'opcua',\r\n    config: { endpointUrl: 'opc.tcp://127.0.0.1:1', timeoutMs: 1000 }\r\n  });\r\n  expect(create.body.success).toBe(true);\r\n  const id = create.body.connection.id;\r\n\r\n  const con = await api.post('/unicon/api/connect').send({ connectionId: id });\r\n  expect(con.status).toBeGreaterThanOrEqual(400);\r\n  expect(con.body.success).toBe(false);\r\n});\r\n\r\ntest('OPC UA connect times out for unreachable host', async () => {\r\n  const create = await api.post('/unicon/api/connections').send({\r\n    name: 'opcua-timeout',\r\n    type: 'opcua',\r\n    config: { endpointUrl: 'opc.tcp://192.0.2.1:4840', timeoutMs: 1000 } // 192.0.2.0/24 TEST-NET-1\r\n  });\r\n  expect(create.body.success).toBe(true);\r\n  const id = create.body.connection.id;\r\n  const con = await api.post('/unicon/api/connect').send({ connectionId: id });\r\n  expect(con.status).toBeGreaterThanOrEqual(400);\r\n  expect(con.body.success).toBe(false);\r\n});"],"mappings":"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","ignoreList":[]}